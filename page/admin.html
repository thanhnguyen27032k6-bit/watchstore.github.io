<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | WatchStore</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>

<body>

    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="logo-title">
                <i class="fas fa-tools"></i> WatchStore ADMIN
            </div>
            <h2>ƒêƒÉng Nh·∫≠p Qu·∫£n Tr·ªã</h2>

            <form class="login-form" id="adminLoginForm">
                <div class="input-group">
                    <label for="username">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="username" name="username" required placeholder="admin" value="admin">
                </div>

                <div class="input-group">
                    <label for="password">M·∫≠t kh·∫©u</label>
                    <input type="password" id="password" name="password" required placeholder="123" value="123">
                </div>

                <p class="error-message" id="loginErrorMessage">T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!</p>

                <button type="submit"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng Nh·∫≠p</button>
            </form>
        </div>
    </div>


    <div class="admin-wrapper" id="adminDashboard">
        <div class="sidebar">
            <h2><i class="fas fa-tools"></i> WatchStore</h2>
            <ul>
                <li><a href="#dashboard" class="active" id="link-dashboard"><i class="fas fa-tachometer-alt"></i>
                        Dashboard</a></li>
                <li><a href="#products"><i class="fas fa-boxes"></i> Qu·∫£n l√Ω S·∫£n ph·∫©m</a></li>
                <li><a href="#categories"><i class="fas fa-tags"></i> Qu·∫£n l√Ω Danh m·ª•c</a></li>
                <li><a href="#orders"><i class="fas fa-shopping-cart"></i> Qu·∫£n l√Ω ƒê∆°n h√†ng</a></li>
                <li><a href="#users"><i class="fas fa-users"></i> Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</a></li>
                <li><a href="#posts"><i class="fas fa-newspaper"></i> Qu·∫£n l√Ω Tin t·ª©c</a></li>
                <li><a href="#settings"><i class="fas fa-cog"></i> C√†i ƒë·∫∑t</a></li>
                <li><a href="#" onclick="logoutAdmin(event)"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t</a></li>
            </ul>
        </div>

        <div class="main-content">
            <div class="admin-header">
                <h1 id="page-title">Dashboard</h1>
                <div class="user-info">
                    Ch√†o m·ª´ng, **<span id="loggedInUser">Admin</span>**! | <a href="#profile"><i
                            class="fas fa-user-circle"></i> T√†i kho·∫£n c·ªßa t√¥i</a>
                </div>
            </div>

            <section id="dashboard" class="dashboard-section">
                <div class="summary-grid">
                    <div class="summary-card">
                        <i class="fas fa-box"></i>
                        <h3>150</h3>
                        <p>T·ªïng S·∫£n ph·∫©m</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-shopping-basket"></i>
                        <h3>45</h3>
                        <p>ƒê∆°n h√†ng m·ªõi</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-users"></i>
                        <h3>1,200</h3>
                        <p>T·ªïng Kh√°ch h√†ng</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-dollar-sign"></i>
                        <h3>150M</h3>
                        <p>Doanh thu (Th√°ng)</p>
                    </div>
                </div>

                <div class="data-table">
                    <h2>ƒê∆°n h√†ng m·ªõi nh·∫•t</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>M√£ ƒêH</th>
                                <th>Kh√°ch h√†ng</th>
                                <th>Ng√†y ƒë·∫∑t</th>
                                <th>T·ªïng ti·ªÅn</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>#DH0001</td>
                                <td>Nguy·ªÖn VƒÉn A</td>
                                <td>28/10/2025</td>
                                <td>1.500.000‚Ç´</td>
                                <td><span class="status-pending">ƒêang ch·ªù x·ª≠ l√Ω</span></td>
                                <td class="action-links">
                                    <a href="#">Xem</a>
                                    <a href="#">Duy·ªát</a>
                                </td>
                            </tr>
                            <tr>
                                <td>#DH0002</td>
                                <td>Tr·∫ßn Th·ªã B</td>
                                <td>27/10/2025</td>
                                <td>5.700.000‚Ç´</td>
                                <td><span class="status-delivered">ƒê√£ giao h√†ng</span></td>
                                <td class="action-links">
                                    <a href="#">Xem</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section id="products" class="data-section" style="display: none;">
                <div class="data-table">
                    <h2>Qu·∫£n l√Ω S·∫£n ph·∫©m</h2>
                    <table id="productTable">
                        <thead>
                            <tr>
                                <th>H√¨nh</th>
                                <th>T√™n s·∫£n ph·∫©m</th>
                                <th>Gi√°</th>
                                <th>Th∆∞∆°ng hi·ªáu</th>
                                <th>Danh m·ª•c</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="productTablebody"></tbody>
                    </table>
                    <div class="actions"><button><i class="fas fa-plus"></i> Th√™m S·∫£n ph·∫©m m·ªõi</button></div>
                    <form id="productForm" style="display:none; margin-top: 20px;">

                        <label>T√™n s·∫£n ph·∫©m</label>
                        <input type="text" id="productName" required>
                    
                        <label>Gi√° s·∫£n ph·∫©m</label>
                        <input type="number" id="productValue" required>
                    
                        <label>Th∆∞∆°ng hi·ªáu</label>
                        <input type="text" id="productBrand" required placeholder="VD: Tissot, Casio, Orient">
                    
                        <label>Danh m·ª•c s·∫£n ph·∫©m</label>
                        <select id="productCate" required>
                            <option value="">--ch·ªçn danh m·ª•c--</option>
                            <option value="nam">Nam</option>
                            <option value="nu">N·ªØ</option>
                            <option value="xuhuong">Xu h∆∞·ªõng 2025</option>
                            <option value="hot">Hot Sale</option>
                        </select>
                    
                        <label>·∫¢nh s·∫£n ph·∫©m</label>
                        <input type="file" id="productImage" accept="image/*">
                        <img id="previewImage" src="" alt="xem tr∆∞·ªõc ·∫£nh" style="max-width:120px; display:none; margin-top:10px; border-radius:8px;">
                    
                        <button type="submit">L∆∞u s·∫£n ph·∫©m</button>
                    </form>
                    
                    
                   
                </div>
            </section>
            <section id="categories" class="data-section" style="display: none;">
                <div class="data-table">
                    <h2>Qu·∫£n l√Ω Danh m·ª•c</h2>
                   <table id="Cate-table">
                        <thead>
                            <tr>
                                <th>T√™n danh m·ª•c</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="CateTableBody"></tbody>
                   </table>

                   <div class="actions">
                        <button id="addCateBtn"><i class="fas fa-plus"></i>T·∫°o danh m·ª•c m·ªõi</button>
                   </div>
                   <form id="CategoryForm" style="display:none; margin-top:20px;">
                        <label>T√™n danh m·ª•c</label>
                        <input type="text" id="categoryName" required>
                        <button type="submit">L∆∞u danh m·ª•c</button>
                   </form>
                </div>
            </section>
            <section id="orders" class="data-section" style="display: none;">
                <div class="data-table">
                    <h2>Qu·∫£n l√Ω ƒê∆°n h√†ng</h2>
                    <p>Danh s√°ch chi ti·∫øt v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng...</p>
                </div>
            </section>
            <section id="users" class="data-section" style="display: none;">
                <div class="data-table">
                    <h2>Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</h2>
                    <p>Qu·∫£n l√Ω t√†i kho·∫£n Admin v√† Kh√°ch h√†ng...</p>
                </div>
            </section>
            <section id="posts" class="data-section" style="display: none;">
                <div class="data-table">
                    <h2>Qu·∫£n l√Ω Tin t·ª©c</h2>
                    <p>Ch·ª©c nƒÉng th√™m/s·ª≠a/x√≥a b√†i vi·∫øt...</p>
                </div>
            </section>
            <section id="settings" class="data-section" style="display: none;">
                <div class="data-table">
                    <h2>C√†i ƒë·∫∑t H·ªá th·ªëng</h2>
                    <p>Ch·ªânh s·ª≠a c√°c thi·∫øt l·∫≠p chung...</p>
                </div>
            </section>
        </div>
    </div>
    <script src="../js/data.js"></script>
    <script>
        // =======================================================
        // PH·∫¶N JAVASCRIPT (auth.js ƒë√£ g·ªôp v√†o)
        // =======================================================
        // --- H√†m lo·∫°i b·ªè d·∫•u v√† t·∫°o slug ƒë·ªìng nh·∫•t ---
function createSlug(str) {
  return str
    .normalize("NFD")              // t√°ch k√Ω t·ª± c√≥ d·∫•u
    .replace(/[\u0300-\u036f]/g, "") // x√≥a d·∫•u
    .toLowerCase()
    .replace(/\s+/g, '')           // b·ªè kho·∫£ng tr·∫Øng
    .trim();
}

        // === ƒê·∫¢M B·∫¢O DANH M·ª§C M·∫∂C ƒê·ªäNH C√ì TRONG LOCALSTORAGE ===
   
    

        const LOGIN_USERNAME = "admin";
        const LOGIN_PASSWORD = "123"; // M·∫≠t kh·∫©u m·∫´u

        const loginForm = document.getElementById('adminLoginForm');
        const loginScreen = document.getElementById('loginScreen');
        const adminDashboard = document.getElementById('adminDashboard');
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        const loggedInUserSpan = document.getElementById('loggedInUser');


        const sidebarLinks = document.querySelectorAll('.sidebar ul li a');
        const mainContentSections = document.querySelectorAll('.main-content .data-section, .main-content .dashboard-section');
        const pageTitle = document.getElementById('page-title');

        // H√†m ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi t·∫£i trang
        function checkLoginStatus() {
            // S·ª≠ d·ª•ng localStorage ƒë·ªÉ gi·ªØ tr·∫°ng th√°i sau khi refresh
            const isLoggedIn = localStorage.getItem('isAdminLoggedIn');
            if (isLoggedIn === 'true') {
                showDashboard(localStorage.getItem('adminUsername') || LOGIN_USERNAME);
            } else {
                showLogin();
            }
        }

        // H√†m x·ª≠ l√Ω ƒëƒÉng nh·∫≠p
        if (loginForm) {
            loginForm.addEventListener('submit', function (e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                // Ki·ªÉm tra m·∫≠t kh·∫©u (M√¥ ph·ªèng Backend)
                if (username === LOGIN_USERNAME && password === LOGIN_PASSWORD) {
                    // ƒêƒÉng nh·∫≠p th√†nh c√¥ng
                    localStorage.setItem('isAdminLoggedIn', 'true');
                    localStorage.setItem('adminUsername', username);
                    showDashboard(username);
                } else {
                    // ƒêƒÉng nh·∫≠p th·∫•t b·∫°i
                    loginErrorMessage.style.display = 'block';
                }
            });
        }

        // H√†m hi·ªÉn th·ªã Dashboard
        function showDashboard(username) {
            loginScreen.style.display = 'none';
            adminDashboard.style.display = 'flex'; // Hi·ªÉn th·ªã dashboard
            loggedInUserSpan.textContent = username;
            loginErrorMessage.style.display = 'none';

            // Chuy·ªÉn ƒë·∫øn Dashboard m·∫∑c ƒë·ªãnh
            // ƒê·∫£m b·∫£o ph·∫ßn t·ª≠ 'link-dashboard' t·ªìn t·∫°i tr∆∞·ªõc khi click
            const dashboardLink = document.getElementById('link-dashboard');
            if (dashboardLink) {
                dashboardLink.click();
            }
        }

        // H√†m hi·ªÉn th·ªã trang Login
        function showLogin() {
            loginScreen.style.display = 'flex';
            adminDashboard.style.display = 'none';
        }

        // H√†m x·ª≠ l√Ω ƒêƒÉng xu·∫•t
        function logoutAdmin(event) {
            event.preventDefault();
            localStorage.setItem('isAdminLoggedIn', 'false');
            localStorage.removeItem('adminUsername');
            showLogin();
        }

        // H√†m chuy·ªÉn ƒë·ªïi tab trong Dashboard
        const hideAllSections = () => {
            mainContentSections.forEach(section => {
                section.style.display = 'none';
            });
        };

        sidebarLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                if (link.getAttribute('href').startsWith('#')) {
                    e.preventDefault();
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                    const targetId = link.getAttribute('href').substring(1);
                    hideAllSections();
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.style.display = 'block';
                        pageTitle.textContent = link.textContent.trim();
                    }
                }
            });
        });

        // Kh·ªüi ƒë·ªông: Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi t·∫£i trang
        checkLoginStatus();
        

        //b·∫Øt ƒë·∫ßu ƒëo·∫°n code th√™m/s·ª≠a/x√≥a
        // ====================== ƒê·ªíNG B·ªò S·∫¢N PH·∫®M T·ª™ data.js V√ÄO ADMIN ======================
(function syncProductsFromDataJS() {
    // N·∫øu ch∆∞a c√≥ s·∫£n ph·∫©m trong localStorage ‚Üí copy t·ª´ data.js
    let stored = JSON.parse(localStorage.getItem("products"));

    if (!stored || stored.length === 0) {
        console.log("‚è≥ Import s·∫£n ph·∫©m t·ª´ data.js v√†o Admin...");
        
        // Chuy·ªÉn PRODUCTS t·ª´ data.js sang localStorage
        const imported = window.PRODUCTS.map(p => ({
            id: p.id,
            name: p.name,
            price: p.price,
            brand: p.brand,
            category: p.category,
            image: p.image,
            sku: p.sku,
            description: p.description,
            specs: p.specs
        }));

        localStorage.setItem("products", JSON.stringify(imported));
    }
})();

        const productForm = document.getElementById("productForm");
        const productTablebody = document.getElementById("productTablebody");
        const addProductBtn = document.querySelector(".actions button");
        const previewImage=document.getElementById("previewImage");
        const productImage=document.getElementById("productImage");

        //l∆∞u danh s√°ch s·∫£n ph·∫©m
        let products = JSON.parse(localStorage.getItem("products"));
            if (!products || !Array.isArray(products) || products.length === 0) {
                products = window.PRODUCTS; 
                localStorage.setItem("products", JSON.stringify(products));
            }

        let editIndex=-1;

        //Hi·ªÉn th·ªã h√¨nh ·∫£nh xem tr∆∞·ªõc khi ch·ªçn file
        productImage.addEventListener("change", function()
        {
            const file=this.files[0];
            if(file)
            {
                const reader=new FileReader();
                reader.onload=function(e)
                {
                    previewImage.src=e.target.result;
                    previewImage.style.display="block";
                };
                reader.readAsDataURL(file);
            }
        })

        //h√†m hi·ªÉn th·ªã s·∫£n ph·∫©m trong b·∫£ng
        function productRender() {
    productTablebody.innerHTML = "";

    products.forEach((p, index) => {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>
                <img src="${p.image}" 
                    onerror="this.src='../image/no-image.png';"

                     style="width:60px;height:60px;border-radius:8px;object-fit:cover;">
            </td>

            <td>${p.name}</td>
            <td>${p.price.toLocaleString()}‚Ç´</td>
            <td>${p.brand}</td>
            <td>${p.category}</td>

            <td>
                <button class="edit-btn" data-index="${index}">
                    <i class="fas fa-pencil"></i>
                </button>
                <button class="delete-btn" data-index="${index}">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;

        productTablebody.appendChild(row);
    });

    attachEditDeleteEvents();
    
    // X√ìA S·∫¢N PH·∫®M
    document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.onclick = () => {
            const i = btn.dataset.index;
            if (confirm("B·∫°n mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")) {
                products.splice(i, 1);
                localStorage.setItem("products", JSON.stringify(products));
                productRender();
            }
        };
    });

    // CH·ªàNH S·ª¨A
    document.querySelectorAll(".edit-btn").forEach(btn => {
        btn.onclick = () => {
            editIndex = btn.dataset.index;
            const product = products[editIndex];
            
            document.getElementById("productName").value = product.name;
            document.getElementById("productValue").value = product.price;
            document.getElementById("productBrand").value = product.brand;
            document.getElementById("productCate").value = product.category;
            
            if (product.image) {
                previewImage.src = product.image;
                previewImage.style.display = "block";
            } else {
                previewImage.style.display = "none";
            }
            
            productForm.style.display = "block";
        };
    });

    
}
         // Khi b·∫•m "Th√™m S·∫£n ph·∫©m m·ªõi"
         addProductBtn.addEventListener("click", () => 
        {
        productForm.style.display = productForm.style.display === "none" ? "block" : "none";
        });
        productForm.addEventListener("submit", (e)=>
        {
            e.preventDefault();
            const name=document.getElementById("productName").value;
            const price=Number(document.getElementById("productValue").value);
            const category=document.getElementById("productCate").value;
            const file=productImage.files[0];
            const defaultImage="https://shopbanhsinhnhat.com/public/uploads/product/IwiO_dang-cap-nhat-san-pham-384.png"
            
            let imageData=null;

            if(file)
            {
                const reader=new FileReader();
                reader.onload=function(e)
                {
                    imageData=e.target.result;
                    saveProduct(name, price, category, imageData);
                };
                reader.readAsDataURL(file);
            }
            else 
            {
                if (editIndex !== -1 && products[editIndex].image) 
                {
                    imageData = products[editIndex].image; 
                } 
                else 
                {
                    imageData = defaultImage; 
                }
                saveProduct(name, price, category, imageData);
            }
        });
        function saveProduct(name, price, category, image) 
        {   
            const selectedCategoryName = category.trim();
            const categorySlug = createSlug(selectedCategoryName); // üëà th√™m d√≤ng n√†y

            const productData = {
    id: editIndex === -1 
        ? "P" + (products.length + 1).toString().padStart(3, "0")
        : products[editIndex].id,

    name,
    price,
    category: selectedCategoryName,
    brand: document.getElementById("productBrand").value,

    image,
    sku: "SKU" + Date.now(),
    description: "S·∫£n ph·∫©m ƒë∆∞·ª£c th√™m t·ª´ Admin Panel",
    specs: {
        size: "ƒêang c·∫≠p nh·∫≠t",
        movement: "ƒêang c·∫≠p nh·∫≠t",
        waterResistance: "ƒêang c·∫≠p nh·∫≠t"
    }
};



            if (editIndex === -1) {
                products.push(productData);
            } else {
                products[editIndex] = productData;
                editIndex = -1;
            }

            localStorage.setItem("products", JSON.stringify(products));
            productRender();
            productForm.reset();
            productForm.style.display = "none"; 
            previewImage.style.display = "none"; 
            productImage.value = "";
        }
        productRender();
    // ==================== CODE PH·∫¶N DANH M·ª§C ====================
/* ============================================================
      QU·∫¢N L√ù DANH M·ª§C (PHI√äN B·∫¢N ƒê√öNG)
============================================================ */

// Danh m·ª•c chu·∫©n: { name, hidden }
let categories = JSON.parse(localStorage.getItem("categories")) || [
  { name: "xuhuong", hidden: false },
  { name: "nam", hidden: false },
  { name: "nu", hidden: false },
  { name: "hot", hidden: false }
];

function saveCategories() {
  localStorage.setItem("categories", JSON.stringify(categories));
}

const CateTableBody = document.getElementById("CateTableBody");
const CategoryForm = document.getElementById("CategoryForm");
const addCateBtn = document.getElementById("addCateBtn");
const categoryNameInput = document.getElementById("categoryName");

let editCategoryIndex = -1;

function renderCategories() {
  CateTableBody.innerHTML = "";

  categories.forEach((cat, index) => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td>
        ${cat.name}
        ${cat.hidden ? `<span style="color:red;">(·∫®n)</span>` : ""}
      </td>

      <td>
        <button class="edit-category" data-index="${index}">
          <i class="fas fa-pencil"></i>
        </button>

        <button class="delete-category" data-index="${index}">
          <i class="fas fa-trash"></i>
        </button>

        <button class="toggle-category" data-index="${index}">
          ${cat.hidden ? "Hi·ªán" : "·∫®n"}
        </button>
      </td>
    `;

    CateTableBody.appendChild(row);
  });

  attachCategoryEvents();
  renderProductDropdown();
}

function attachCategoryEvents() {
  document.querySelectorAll(".edit-category").forEach(btn => {
    btn.onclick = () => {
      editCategoryIndex = btn.dataset.index;
      categoryNameInput.value = categories[editCategoryIndex].name;
      CategoryForm.style.display = "block";
    };
  });

  document.querySelectorAll(".delete-category").forEach(btn => {
    btn.onclick = () => {
      const i = btn.dataset.index;
      if (!confirm("X√≥a danh m·ª•c?")) return;

      categories.splice(i, 1);
      saveCategories();
      renderCategories();
    };
  });

  document.querySelectorAll(".toggle-category").forEach(btn => {
    btn.onclick = () => {
      const i = btn.dataset.index;
      categories[i].hidden = !categories[i].hidden;
      saveCategories();
      renderCategories();
    };
  });
}

addCateBtn.onclick = () => {
  CategoryForm.style.display =
    CategoryForm.style.display === "none" ? "block" : "none";

  editCategoryIndex = -1;
  categoryNameInput.value = "";
};

CategoryForm.onsubmit = (e) => {
  e.preventDefault();

  const name = categoryNameInput.value.trim().toLowerCase();
  if (!name) return;

  if (editCategoryIndex === -1) {
    categories.push({ name, hidden: false });
  } else {
    categories[editCategoryIndex].name = name;
  }

  saveCategories();
  renderCategories();
  CategoryForm.reset();
  CategoryForm.style.display = "none";
};

// ƒê·ªï danh m·ª•c ra dropdown s·∫£n ph·∫©m
function renderProductDropdown() {
  const productCate = document.getElementById("productCate");
  if (!productCate) return;

  productCate.innerHTML = `<option value="">--ch·ªçn danh m·ª•c--</option>`;

  categories.forEach(c => {
    if (!c.hidden) {  
      productCate.innerHTML += `<option value="${c.name}">${c.name}</option>`;
    }
  });
}

renderCategories();
renderProductDropdown();



       
    </script>
    
</body>

</html>
