<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gi·ªè H√†ng & Thanh To√°n - WatchStore</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
    />
    <style>
      :root {
        --color-primary: #ff7b00;
        --color-secondary: #fff;
        --color-text: #333;
        --color-danger: #d70018;
        --color-success: #28a745;
        --color-border: #eee;
        --color-bg: #f5f5f5;
        --color-warning: #ffc107;
        --color-info: #17a2b8;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--color-bg);
        color: var(--color-text);
        line-height: 1.6;
        padding-top: 120px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
      }

      /* Header Styles */
      .header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
        background-color: var(--color-secondary);
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
      }

      .header-top {
        background-color: var(--color-primary);
        overflow: hidden;
        white-space: nowrap;
        position: relative;
        padding: 10px 0;
      }

      .header-top span {
        display: inline-block;
        font-weight: bold;
        font-size: 18px;
        color: #fff;
        position: relative;
        left: -100%;
        animation: slideRight 15s linear infinite;
      }

      @keyframes slideRight {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .header-main .inner-wrap {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
      }

      .header-main .inner-logo a {
        color: var(--color-primary);
        display: flex;
        align-items: center;
        text-decoration: none;
      }

      .header-main .inner-logo span {
        font-size: 22px;
        font-weight: 600;
      }

      .header-main .inner-logo img {
        height: 48px;
        margin-right: 10px;
      }

      .header-main .inner-menu {
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .search-box {
        position: relative;
        width: 300px;
      }

      .search-box input {
        width: 100%;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 20px;
        font-size: 14px;
      }

      .search-box button {
        position: absolute;
        right: 5px;
        top: 5px;
        background: none;
        border: none;
        color: #666;
        cursor: pointer;
      }

      /* User Info Styles */
      .user-info {
        display: flex;
        align-items: center;
        background: rgba(255, 123, 0, 0.1);
        padding: 8px 12px;
        border-radius: 6px;
        border: 1px solid rgba(255, 123, 0, 0.2);
        margin-right: 15px;
      }

      .user-info span {
        font-weight: bold;
        color: #333;
      }

      .logout-btn {
        margin-left: 10px;
        padding: 4px 8px;
        background: #ff6b6b;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        transition: background 0.3s;
      }

      .logout-btn:hover {
        background: #ff5252;
      }

      .header-icons {
        display: flex;
        gap: 20px;
        align-items: center;
      }

      .icon-wrapper {
        position: relative;
        cursor: pointer;
      }

      .icon-wrapper i {
        font-size: 22px;
        color: var(--color-text);
        transition: color 0.3s;
      }

      .icon-wrapper:hover i {
        color: var(--color-primary);
      }

      .badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--color-primary);
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* Notification Styles */
      .login-required-notification {
        position: fixed;
        top: 120px;
        right: 20px;
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        padding: 20px 25px;
        border-radius: 12px;
        z-index: 10000;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        animation: slideIn 0.5s ease;
        max-width: 350px;
        font-weight: 500;
        border-left: 5px solid #c23616;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        cursor: pointer;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      /* Breadcrumb */
      .breadcrumb {
        padding: 15px 0;
        font-size: 14px;
        color: #666;
      }

      .breadcrumb a {
        color: #666;
        text-decoration: none;
      }

      .breadcrumb a:hover {
        color: var(--color-primary);
      }

      /* Navigation Tabs */
      .nav-tabs {
        display: flex;
        background: white;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        overflow-x: auto;
      }

      .nav-tab {
        padding: 12px 24px;
        border: none;
        background: none;
        font-size: 16px;
        font-weight: 600;
        color: #666;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.3s;
        position: relative;
        white-space: nowrap;
        flex-shrink: 0;
      }

      .nav-tab.active {
        color: var(--color-primary);
        background: rgba(255, 123, 0, 0.1);
      }

      .nav-tab.active::after {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 0;
        width: 100%;
        height: 3px;
        background: var(--color-primary);
        border-radius: 3px;
      }

      .nav-tab .badge {
        position: relative;
        top: -2px;
        right: -5px;
        background: var(--color-danger);
        font-size: 10px;
        width: 16px;
        height: 16px;
      }

      /* Page Sections */
      .page-section {
        display: none;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.3s ease;
      }

      .page-section.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Cart Section */
      .cart-section,
      .order-history-section,
      .checkout-section {
        background: #fff;
        border-radius: 8px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .section-title {
        font-size: 24px;
        margin-bottom: 20px;
        color: #333;
        border-bottom: 2px solid var(--color-primary);
        padding-bottom: 10px;
      }

      .cart-items {
        margin-bottom: 30px;
      }

      .cart-item {
        display: flex;
        align-items: center;
        padding: 20px 0;
        border-bottom: 1px solid var(--color-border);
        gap: 20px;
        transition: all 0.3s ease;
      }

      .cart-item.removing {
        opacity: 0;
        transform: translateX(-20px);
      }

      .cart-item-image {
        width: 100px;
        height: 100px;
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .cart-item-image img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .cart-item-info {
        flex: 1;
      }

      .cart-item-name {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 5px;
        color: #333;
      }

      .cart-item-sku {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
      }

      .cart-item-price {
        font-size: 18px;
        font-weight: bold;
        color: var(--color-danger);
      }

      .cart-item-quantity {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .quantity-btn {
        width: 30px;
        height: 30px;
        border: 1px solid #ddd;
        background: #f8f9fa;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .quantity-btn:hover {
        background: var(--color-primary);
        color: white;
        border-color: var(--color-primary);
      }

      .quantity-btn:disabled {
        background: #f5f5f5;
        color: #ccc;
        cursor: not-allowed;
        border-color: #eee;
      }

      .quantity-btn:disabled:hover {
        background: #f5f5f5;
        color: #ccc;
        border-color: #eee;
      }

      .quantity-input {
        width: 50px;
        height: 30px;
        border: 1px solid #ddd;
        border-radius: 4px;
        text-align: center;
        font-size: 14px;
      }

      .cart-item-total {
        font-size: 18px;
        font-weight: bold;
        color: var(--color-danger);
        min-width: 100px;
        text-align: right;
      }

      .cart-item-remove {
        color: #666;
        cursor: pointer;
        transition: color 0.3s;
        padding: 5px;
      }

      .cart-item-remove:hover {
        color: var(--color-danger);
      }

      .cart-summary {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 25px;
        margin-top: 20px;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        font-size: 16px;
      }

      .summary-row.total {
        font-size: 20px;
        font-weight: bold;
        color: var(--color-danger);
        border-top: 1px solid #ddd;
        padding-top: 15px;
        margin-top: 15px;
      }

      .cart-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        gap: 20px;
      }

      /* Checkout Form Styles */
      .checkout-layout {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 30px;
      }

      .checkout-form {
        background: #fff;
        border-radius: 8px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }

      .form-section {
        margin-bottom: 30px;
      }

      .form-section-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .form-section-title i {
        color: var(--color-primary);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
      }

      .form-input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
        transition: border-color 0.3s;
      }

      .form-input:focus {
        outline: none;
        border-color: var(--color-primary);
      }

      .form-input.error {
        border-color: var(--color-danger);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      /* Payment Methods */
      .payment-methods {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .payment-method {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .payment-method:hover {
        border-color: var(--color-primary);
      }

      .payment-method.selected {
        border-color: var(--color-primary);
        background: #fff5f5;
      }

      .payment-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
      }

      .payment-icon {
        width: 40px;
        height: 40px;
        background: #f8f9fa;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .payment-name {
        font-weight: 600;
        color: #333;
      }

      .payment-description {
        font-size: 14px;
        color: #666;
        line-height: 1.4;
      }

      /* Order Summary */
      .order-summary {
        background: #fff;
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        height: fit-content;
        position: sticky;
        top: 140px;
      }

      .order-items {
        margin-bottom: 20px;
      }

      .order-item {
        display: flex;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--color-border);
        gap: 15px;
      }

      .order-item-image {
        width: 60px;
        height: 60px;
        border: 1px solid var(--color-border);
        border-radius: 4px;
        padding: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .order-item-image img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .order-item-info {
        flex: 1;
      }

      .order-item-name {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 5px;
        color: #333;
      }

      .order-item-price {
        font-size: 14px;
        color: var(--color-danger);
        font-weight: 600;
      }

      .order-item-quantity {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .order-totals {
        border-top: 1px solid var(--color-border);
        padding-top: 20px;
      }

      .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 14px;
      }

      .total-row.final {
        font-size: 18px;
        font-weight: bold;
        color: var(--color-danger);
        border-top: 1px solid var(--color-border);
        padding-top: 10px;
        margin-top: 10px;
      }

      /* Confirmation Section */
      .confirmation-section {
        padding: 30px 0;
        margin-bottom: 30px;
      }

      .confirmation-box {
        background: var(--color-secondary);
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .confirmation-icon {
        color: var(--color-success);
        font-size: 60px;
        margin-bottom: 20px;
      }

      .confirmation-title {
        font-size: 28px;
        color: var(--color-success);
        margin-bottom: 10px;
      }

      .confirmation-text {
        font-size: 16px;
        color: #666;
        margin-bottom: 30px;
      }

      .order-info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 30px;
        text-align: left;
        border-top: 1px dashed #ccc;
        padding-top: 30px;
      }

      .info-card {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 6px;
        border-left: 5px solid var(--color-primary);
      }

      .info-card h4 {
        font-size: 18px;
        margin-bottom: 15px;
        color: var(--color-primary);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .info-card p {
        font-size: 14px;
        margin-bottom: 8px;
        color: #555;
      }

      .info-card strong {
        color: var(--color-text);
      }

      .order-details-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 30px;
      }

      .order-details-table th,
      .order-details-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--color-border);
        font-size: 14px;
      }

      .order-details-table th {
        background-color: #f1f1f1;
        font-weight: 600;
        color: #333;
      }

      .item-name {
        font-weight: 500;
        color: var(--color-text);
      }

      .item-price {
        color: var(--color-danger);
        font-weight: 600;
      }

      .order-summary-footer {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--color-border);
        max-width: 400px;
        margin-left: auto;
        text-align: right;
      }

      .summary-row.final {
        font-size: 20px;
        font-weight: bold;
        color: var(--color-danger);
        padding-top: 10px;
        border-top: 1px dashed #ccc;
      }

      /* Order History Styles */
      .order-filters {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .filter-select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        font-size: 14px;
        min-width: 150px;
      }

      .order-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .order-card {
        border: 1px solid var(--color-border);
        border-radius: 8px;
        padding: 20px;
        background: white;
        transition: all 0.3s;
        cursor: pointer;
      }

      .order-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }

      .order-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
      }

      .order-info {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .order-id {
        font-size: 18px;
        font-weight: bold;
        color: var(--color-primary);
      }

      .order-date {
        font-size: 14px;
        color: #666;
      }

      .order-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .status-confirmed {
        background: #d1ecf1;
        color: #0c5460;
      }

      .status-shipping {
        background: #d1e7ff;
        color: #004085;
      }

      .status-completed {
        background: #d4edda;
        color: #155724;
      }

      .status-cancelled {
        background: #f8d7da;
        color: #721c24;
      }

      .order-summary-short {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
      }

      .order-items-count {
        font-size: 14px;
        color: #666;
      }

      .order-total {
        font-size: 18px;
        font-weight: bold;
        color: var(--color-danger);
      }

      .order-details {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px dashed #eee;
        display: none;
      }

      .order-details.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      .order-items-list {
        margin-bottom: 15px;
      }

      .order-item-history {
        display: flex;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #f5f5f5;
        gap: 15px;
      }

      .order-item-history:last-child {
        border-bottom: none;
      }

      .order-item-image-history {
        width: 60px;
        height: 60px;
        border: 1px solid var(--color-border);
        border-radius: 4px;
        padding: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .order-item-image-history img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .order-item-info-history {
        flex: 1;
      }

      .order-item-name-history {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 5px;
        color: #333;
      }

      .order-item-price-history {
        font-size: 14px;
        color: var(--color-danger);
        font-weight: 600;
      }

      .order-item-quantity-history {
        font-size: 14px;
        color: #666;
      }

      .order-shipping-info {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-top: 15px;
      }

      .shipping-title {
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
      }

      .shipping-address {
        font-size: 14px;
        color: #666;
        line-height: 1.5;
      }

      .empty-state {
        text-align: center;
        padding: 50px 20px;
      }

      .empty-state i {
        font-size: 64px;
        color: #ddd;
        margin-bottom: 20px;
      }

      .empty-state p {
        font-size: 18px;
        color: #666;
        margin-bottom: 20px;
      }

      .error-message {
        color: var(--color-danger);
        font-size: 14px;
        margin-top: 5px;
        display: none;
      }

      /* Buttons */
      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .btn-continue {
        background: white;
        color: var(--color-primary);
        border: 2px solid var(--color-primary);
      }

      .btn-continue:hover {
        background: #fff5f5;
      }

      .btn-checkout {
        background: var(--color-primary);
        color: white;
      }

      .btn-checkout:hover {
        background: #e56a00;
      }

      .btn-checkout:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      .btn-view-details {
        background: none;
        border: 1px solid #ddd;
        color: #666;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-view-details:hover {
        background: #f8f9fa;
        border-color: #ccc;
      }

      .btn-home {
        display: inline-block;
        margin-top: 30px;
        padding: 10px 30px;
        background: var(--color-primary);
        color: var(--color-secondary);
        text-decoration: none;
        border-radius: 4px;
        font-weight: 600;
        transition: background 0.3s;
      }

      .btn-home:hover {
        background: #e56a00;
      }

      /* Footer */
      .footer {
        background-color: #000;
        color: #fff;
        padding: 50px 60px 20px;
        font-family: "Arial", sans-serif;
      }

      .footer-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
      }

      .footer-column h3 {
        color: #ff7c00;
        margin-bottom: 15px;
        font-size: 18px;
        text-transform: uppercase;
      }

      .footer-column ul {
        list-style: none;
        padding: 0;
      }

      .footer-column ul li {
        margin-bottom: 8px;
      }

      .footer-column ul li a {
        color: #fff;
        text-decoration: none;
        transition: color 0.2s;
      }

      .footer-column ul li a:hover {
        color: #ff7c00;
      }

      .footer-column p {
        margin: 6px 0;
        color: #ccc;
      }

      .social-icons a {
        color: #fff;
        margin-right: 12px;
        font-size: 20px;
        transition: color 0.3s;
      }

      .social-icons a:hover {
        color: #ff7c00;
      }

      .footer-bottom {
        border-top: 1px solid #333;
        margin-top: 40px;
        padding-top: 15px;
        text-align: center;
        font-size: 13px;
        color: #aaa;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .cart-item {
          flex-direction: column;
          text-align: center;
          gap: 15px;
        }

        .cart-item-info {
          text-align: center;
        }

        .cart-item-quantity {
          justify-content: center;
        }

        .cart-actions {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }

        .checkout-layout {
          grid-template-columns: 1fr;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .order-summary {
          position: static;
        }

        .order-info-grid {
          grid-template-columns: 1fr;
        }

        .order-header {
          flex-direction: column;
          align-items: flex-start;
        }

        .order-summary-short {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .nav-tabs {
          flex-direction: row;
          overflow-x: auto;
          gap: 5px;
          padding: 8px;
        }

        .nav-tab {
          padding: 10px 16px;
          font-size: 14px;
        }

        .nav-tab.active::after {
          bottom: -8px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-top">
        <span
          >üî• ∆ØU ƒê√ÉI ƒê·∫∂C BI·ªÜT: Gi·∫£m 20% cho ƒë∆°n h√†ng ƒë·∫ßu ti√™n - Mi·ªÖn ph√≠ v·∫≠n
          chuy·ªÉn to√†n qu·ªëc üî•</span
        >
      </div>
      <div class="header-main">
        <div class="container">
          <div class="inner-wrap">
            <div class="inner-logo">
              <a href="../index.html">
                <div
                  style="
                    width: 48px;
                    height: 48px;
                    background: var(--color-primary);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 8px;
                    margin-right: 10px;
                  "
                >
                  <i
                    class="fas fa-clock"
                    style="color: white; font-size: 24px"
                  ></i>
                </div>
                <span>WATCHSTORE</span>
              </a>
            </div>
            <div class="inner-menu">
              <div class="search-box">
                <input type="text" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." />
                <button><i class="fas fa-search"></i></button>
              </div>

              <!-- User info v√† n√∫t ƒëƒÉng xu·∫•t -->
              <div class="user-info" id="userInfo" style="display: none">
                <span id="userName"></span>
                <button class="logout-btn" id="logoutBtn">ƒêƒÉng xu·∫•t</button>
              </div>

              <div class="header-icons">
                <div class="icon-wrapper" id="wishlist-icon">
                  <i class="far fa-heart"></i>
                  <div class="badge" id="wishlist-count">2</div>
                </div>
                <div class="icon-wrapper" id="cart-icon">
                  <i class="fas fa-shopping-cart"></i>
                  <div class="badge" id="cart-count">0</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <!-- Breadcrumb -->
      <div class="breadcrumb" id="breadcrumb">
        <a href="../index.html">Trang ch·ªß</a> >
        <a href="#" id="breadcrumb-current">Gi·ªè h√†ng</a>
      </div>

      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button class="nav-tab active" data-target="cart-page">
          <i class="fas fa-shopping-cart"></i> Gi·ªè h√†ng
          <span class="badge" id="cart-tab-count">0</span>
        </button>
        <button class="nav-tab" data-target="checkout-page">
          <i class="fas fa-credit-card"></i> Thanh to√°n
        </button>
        <button class="nav-tab" data-target="order-history-page">
          <i class="fas fa-history"></i> L·ªãch s·ª≠ ƒë∆°n h√†ng
          <span class="badge" id="orders-tab-count">0</span>
        </button>
      </div>

      <!-- Cart Page -->
      <div class="page-section active" id="cart-page">
        <div class="cart-section">
          <h1 class="section-title">Gi·ªè H√†ng</h1>

          <div class="cart-items" id="cart-items-container">
            <!-- C√°c s·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
          </div>

          <div class="cart-summary">
            <div class="summary-row">
              <span>T·∫°m t√≠nh:</span>
              <span id="subtotal">0‚Ç´</span>
            </div>
            <div class="summary-row">
              <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
              <span id="shipping">Mi·ªÖn ph√≠</span>
            </div>
            <div class="summary-row">
              <span>Gi·∫£m gi√° (20%):</span>
              <span id="discount">-0‚Ç´</span>
            </div>
            <div class="summary-row total">
              <span>T·ªïng c·ªông:</span>
              <span id="total">0‚Ç´</span>
            </div>
          </div>

          <div class="cart-actions">
            <button
              class="btn btn-continue"
              onclick="window.location.href='../index.html'"
            >
              <i class="fas fa-arrow-left"></i> Ti·∫øp t·ª•c mua h√†ng
            </button>
            <button class="btn btn-checkout" id="go-to-checkout">
              Thanh to√°n <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Checkout Page -->
      <div class="page-section" id="checkout-page">
        <div class="checkout-section">
          <h1 class="section-title">Thanh To√°n</h1>

          <div class="checkout-layout">
            <!-- Checkout Form -->
            <div class="checkout-form">
              <!-- Customer Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-user"></i> Th√¥ng tin kh√°ch h√†ng
                </h3>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="fullname">H·ªç v√† t√™n *</label>
                    <input
                      type="text"
                      id="fullname"
                      class="form-input"
                      placeholder="Nh·∫≠p h·ªç v√† t√™n"
                      required
                    />
                    <div class="error-message" id="fullname-error">
                      Vui l√≤ng nh·∫≠p h·ªç v√† t√™n
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="phone"
                      >S·ªë ƒëi·ªán tho·∫°i *</label
                    >
                    <input
                      type="tel"
                      id="phone"
                      class="form-input"
                      placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"
                      required
                    />
                    <div class="error-message" id="phone-error">
                      Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label" for="email">Email</label>
                  <input
                    type="email"
                    id="email"
                    class="form-input"
                    placeholder="Nh·∫≠p email (kh√¥ng b·∫Øt bu·ªôc)"
                  />
                </div>
              </div>

              <!-- Shipping Address -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-map-marker-alt"></i> ƒê·ªãa ch·ªâ giao h√†ng
                </h3>
                <div class="form-group">
                  <label class="form-label" for="address">ƒê·ªãa ch·ªâ *</label>
                  <input
                    type="text"
                    id="address"
                    class="form-input"
                    placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng"
                    required
                  />
                  <div class="error-message" id="address-error">
                    Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ giao h√†ng
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label class="form-label" for="city"
                      >T·ªânh/Th√†nh ph·ªë *</label
                    >
                    <select id="city" class="form-input" required>
                      <option value="">Ch·ªçn t·ªânh/th√†nh ph·ªë</option>
                      <option value="hcm">TP. H·ªì Ch√≠ Minh</option>
                      <option value="hn">H√† N·ªôi</option>
                      <option value="dn">ƒê√† N·∫µng</option>
                    </select>
                    <div class="error-message" id="city-error">
                      Vui l√≤ng ch·ªçn t·ªânh/th√†nh ph·ªë
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="form-label" for="district"
                      >Qu·∫≠n/Huy·ªán *</label
                    >
                    <select id="district" class="form-input" required>
                      <option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>
                    </select>
                    <div class="error-message" id="district-error">
                      Vui l√≤ng ch·ªçn qu·∫≠n/huy·ªán
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label" for="note">Ghi ch√∫ ƒë∆°n h√†ng</label>
                  <textarea
                    id="note"
                    class="form-input"
                    rows="3"
                    placeholder="Ghi ch√∫ v·ªÅ ƒë∆°n h√†ng (kh√¥ng b·∫Øt bu·ªôc)"
                  ></textarea>
                </div>
              </div>

              <!-- Payment Method -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-credit-card"></i> Ph∆∞∆°ng th·ª©c thanh to√°n
                </h3>
                <div class="payment-methods">
                  <div class="payment-method selected" data-method="cod">
                    <div class="payment-header">
                      <div class="payment-icon">
                        <i class="fas fa-money-bill-wave"></i>
                      </div>
                      <div class="payment-name">
                        Thanh to√°n khi nh·∫≠n h√†ng (COD)
                      </div>
                    </div>
                    <div class="payment-description">
                      Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n ƒë∆∞·ª£c h√†ng
                    </div>
                  </div>
                  <div class="payment-method" data-method="banking">
                    <div class="payment-header">
                      <div class="payment-icon">
                        <i class="fas fa-university"></i>
                      </div>
                      <div class="payment-name">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</div>
                    </div>
                    <div class="payment-description">
                      Chuy·ªÉn kho·∫£n qua t√†i kho·∫£n ng√¢n h√†ng
                    </div>
                  </div>
                  <div class="payment-method" data-method="momo">
                    <div class="payment-header">
                      <div class="payment-icon">
                        <i class="fas fa-mobile-alt"></i>
                      </div>
                      <div class="payment-name">V√≠ MoMo</div>
                    </div>
                    <div class="payment-description">
                      Thanh to√°n qua ·ª©ng d·ª•ng MoMo
                    </div>
                  </div>
                </div>
              </div>

              <button class="btn btn-checkout" id="complete-order">
                <i class="fas fa-lock"></i> Ho√†n t·∫•t ƒë∆°n h√†ng
              </button>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
              <h3 class="form-section-title">ƒê∆°n h√†ng c·ªßa b·∫°n</h3>

              <div class="order-items" id="order-items-container">
                <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
              </div>

              <div class="order-totals">
                <div class="total-row">
                  <span>T·∫°m t√≠nh:</span>
                  <span id="checkout-subtotal">0‚Ç´</span>
                </div>
                <div class="total-row">
                  <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                  <span id="checkout-shipping">Mi·ªÖn ph√≠</span>
                </div>
                <div class="total-row">
                  <span>Gi·∫£m gi√°:</span>
                  <span id="checkout-discount">-0‚Ç´</span>
                </div>
                <div class="total-row final">
                  <span>T·ªïng c·ªông:</span>
                  <span id="checkout-total">0‚Ç´</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Confirmation Page -->
      <div class="page-section" id="confirmation-page">
        <div class="confirmation-section">
          <div class="confirmation-box">
            <i class="fas fa-check-circle confirmation-icon"></i>
            <h1 class="confirmation-title">ƒê·∫∑t H√†ng Th√†nh C√¥ng!</h1>
            <p class="confirmation-text">
              C·∫£m ∆°n b·∫°n ƒë√£ tin t∆∞·ªüng v√† ƒë·∫∑t h√†ng t·∫°i WatchStore. D∆∞·ªõi ƒë√¢y l√†
              th√¥ng tin chi ti·∫øt ƒë∆°n h√†ng c·ªßa b·∫°n.
            </p>

            <div class="order-info-grid">
              <!-- Th√¥ng tin ƒë∆°n h√†ng -->
              <div class="info-card">
                <h4><i class="fas fa-file-invoice"></i> Chi ti·∫øt ƒê∆°n h√†ng</h4>
                <p>
                  <strong>M√£ ƒë∆°n h√†ng:</strong>
                  <span id="order-id">#WS102025</span>
                </p>
                <p>
                  <strong>Ng√†y ƒë·∫∑t h√†ng:</strong>
                  <span id="order-date">31/10/2025</span>
                </p>
                <p>
                  <strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong>
                  <span id="payment-method"
                    >COD (Thanh to√°n khi nh·∫≠n h√†ng)</span
                  >
                </p>
                <p><strong>Tr·∫°ng th√°i:</strong> ƒêang ch·ªù x√°c nh·∫≠n</p>
              </div>

              <!-- Th√¥ng tin ng∆∞·ªùi nh·∫≠n -->
              <div class="info-card">
                <h4>
                  <i class="fas fa-map-marker-alt"></i> Th√¥ng tin Ng∆∞·ªùi nh·∫≠n
                </h4>
                <p>
                  <strong>H·ªç t√™n:</strong>
                  <span id="customer-name">Nguy·ªÖn VƒÉn A</span>
                </p>
                <p>
                  <strong>ƒêi·ªán tho·∫°i:</strong>
                  <span id="customer-phone">0987 654 321</span>
                </p>
                <p>
                  <strong>Email:</strong>
                  <span id="customer-email">anva@example.com</span>
                </p>
                <p>
                  <strong>ƒê·ªãa ch·ªâ:</strong>
                  <span id="customer-address"
                    >123 Nguy·ªÖn Tr√£i, Qu·∫≠n 1, TP. H·ªì Ch√≠ Minh</span
                  >
                </p>
                <p id="customer-note">
                  <strong>Ghi ch√∫:</strong>
                  <span id="note-text">G·ªçi tr∆∞·ªõc khi giao</span>
                </p>
              </div>
            </div>

            <!-- Danh s√°ch s·∫£n ph·∫©m -->
            <div class="order-details-section">
              <h4
                style="
                  margin-top: 40px;
                  text-align: left;
                  color: var(--color-primary);
                  font-size: 20px;
                "
              >
                <i class="fas fa-box-open"></i> Danh s√°ch s·∫£n ph·∫©m
              </h4>
              <table class="order-details-table">
                <thead>
                  <tr>
                    <th style="width: 50%">S·∫£n ph·∫©m</th>
                    <th>S·ªë l∆∞·ª£ng</th>
                    <th style="text-align: right">ƒê∆°n gi√°</th>
                    <th style="text-align: right">Th√†nh ti·ªÅn</th>
                  </tr>
                </thead>
                <tbody id="confirmation-items-body">
                  <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
                </tbody>
              </table>
            </div>

            <!-- T·ªïng k·∫øt ƒë∆°n h√†ng -->
            <div class="order-summary-footer">
              <div class="summary-row">
                <span>T·∫°m t√≠nh:</span>
                <span id="confirmation-subtotal">0‚Ç´</span>
              </div>
              <div class="summary-row">
                <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                <span id="confirmation-shipping">Mi·ªÖn ph√≠</span>
              </div>
              <div class="summary-row">
                <span>Gi·∫£m gi√°:</span>
                <span id="confirmation-discount">-0‚Ç´</span>
              </div>
              <div class="summary-row final">
                <span>T·ªïng c·ªông:</span>
                <span id="confirmation-total">0‚Ç´</span>
              </div>
            </div>

            <a href="../index.html" class="btn-home">
              <i class="fas fa-home"></i> Quay v·ªÅ trang ch·ªß
            </a>
          </div>
        </div>
      </div>

      <!-- Order History Page -->
      <div class="page-section" id="order-history-page">
        <div class="order-history-section">
          <h1 class="section-title">L·ªãch s·ª≠ ƒë∆°n h√†ng</h1>

          <div class="order-filters">
            <select class="filter-select" id="status-filter">
              <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
              <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
              <option value="confirmed">ƒê√£ x√°c nh·∫≠n</option>
              <option value="shipping">ƒêang giao h√†ng</option>
              <option value="completed">ƒê√£ ho√†n th√†nh</option>
              <option value="cancelled">ƒê√£ h·ªßy</option>
            </select>

            <select class="filter-select" id="time-filter">
              <option value="all">T·∫•t c·∫£ th·ªùi gian</option>
              <option value="7days">7 ng√†y g·∫ßn ƒë√¢y</option>
              <option value="30days">30 ng√†y g·∫ßn ƒë√¢y</option>
              <option value="3months">3 th√°ng g·∫ßn ƒë√¢y</option>
              <option value="6months">6 th√°ng g·∫ßn ƒë√¢y</option>
            </select>

            <button class="btn btn-continue" id="refresh-orders">
              <i class="fas fa-sync-alt"></i> L√†m m·ªõi
            </button>
          </div>

          <div class="order-list" id="order-list-container">
            <!-- C√°c ƒë∆°n h√†ng s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-container">
        <div class="footer-column">
          <h3>V·ªÅ WatchStore</h3>
          <p>
            WatchStore - ƒê·ªãa ch·ªâ uy t√≠n h√†ng ƒë·∫ßu v·ªÅ ƒë·ªìng h·ªì ch√≠nh h√£ng v·ªõi h∆°n
            10 nƒÉm kinh nghi·ªám trong ng√†nh.
          </p>
          <div class="social-icons">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-youtube"></i></a>
            <a href="#"><i class="fab fa-tiktok"></i></a>
          </div>
        </div>
        <div class="footer-column">
          <h3>Th√¥ng tin li√™n h·ªá</h3>
          <p>
            <i class="fas fa-map-marker-alt"></i> 123 Nguy·ªÖn Tr√£i, Qu·∫≠n 1,
            TP.HCM
          </p>
          <p><i class="fas fa-phone"></i> 1900 1234</p>
          <p><i class="fas fa-envelope"></i> support@watchstore.vn</p>
        </div>
        <div class="footer-column">
          <h3>Ch√≠nh s√°ch</h3>
          <ul>
            <li><a href="#">Ch√≠nh s√°ch b·∫£o h√†nh</a></li>
            <li><a href="#">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
            <li><a href="#">Ch√≠nh s√°ch v·∫≠n chuy·ªÉn</a></li>
            <li><a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>H·ªó tr·ª£ kh√°ch h√†ng</h3>
          <ul>
            <li><a href="#">H∆∞·ªõng d·∫´n mua h√†ng</a></li>
            <li><a href="#">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a></li>
            <li><a href="#">H·ªá th·ªëng c·ª≠a h√†ng</a></li>
            <li><a href="#">Tuy·ªÉn d·ª•ng</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 WatchStore. T·∫•t c·∫£ c√°c quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
      </div>
    </footer>

    <script>
      // H·ªá th·ªëng qu·∫£n l√Ω ƒëƒÉng nh·∫≠p
      class LoginManager {
        constructor() {
          this.init();
        }

        init() {
          this.checkLoginStatus();
          this.setupEventListeners();
        }

        // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
        checkLoginStatus() {
          const userData = JSON.parse(localStorage.getItem("currentUser"));

          if (userData && userData.isLoggedIn) {
            this.showUserInfo(userData);
            return true;
          } else {
            this.hideUserInfo();
            this.showLoginRequiredNotification();
            return false;
          }
        }

        // Hi·ªÉn th·ªã th√¥ng tin user
        showUserInfo(userData) {
          const userInfo = document.getElementById("userInfo");
          const userName = document.getElementById("userName");

          if (userInfo && userName) {
            userInfo.style.display = "flex";
            userName.textContent = userData.fullname || userData.phone;
          }
        }

        // ·∫®n th√¥ng tin user
        hideUserInfo() {
          const userInfo = document.getElementById("userInfo");
          if (userInfo) {
            userInfo.style.display = "none";
          }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o y√™u c·∫ßu ƒëƒÉng nh·∫≠p
        showLoginRequiredNotification() {
          const existingNotification = document.querySelector(
            ".login-required-notification"
          );
          if (existingNotification) {
            existingNotification.remove();
          }

          const notification = document.createElement("div");
          notification.className = "login-required-notification";
          notification.innerHTML = `
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 50%;">
                            <i class="fas fa-exclamation-circle" style="font-size: 24px;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold; font-size: 16px; margin-bottom: 8px;">üîí Y√™u c·∫ßu ƒëƒÉng nh·∫≠p</div>
                            <div style="font-size: 13px; opacity: 0.95; line-height: 1.4;">
                                Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ truy c·∫≠p gi·ªè h√†ng v√† thanh to√°n.
                            </div>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer; padding: 5px;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

          // Click v√†o th√¥ng b√°o ƒë·ªÉ chuy·ªÉn ƒë·∫øn trang ƒëƒÉng nh·∫≠p
          notification.addEventListener("click", () => {
            window.location.href = "../index.html";
          });

          document.body.appendChild(notification);

          // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
          setTimeout(() => {
            if (notification.parentNode) {
              notification.style.animation = "slideOut 0.5s ease";
              setTimeout(() => {
                if (notification.parentNode) {
                  notification.parentNode.removeChild(notification);
                }
              }, 500);
            }
          }, 5000);
        }

        // X·ª≠ l√Ω ƒëƒÉng xu·∫•t
        handleLogout() {
          // L∆∞u gi·ªè h√†ng tr∆∞·ªõc khi ƒëƒÉng xu·∫•t
          this.saveUserCartBeforeLogout();

          // X√≥a th√¥ng tin user
          localStorage.removeItem("currentUser");

          // T·∫°o gi·ªè h√†ng tr·ªëng
          const emptyCart = {
            items: [],
            subtotal: 0,
            discount: 0,
            total: 0,
            lastUpdated: new Date().toISOString(),
          };
          localStorage.setItem("cartData", JSON.stringify(emptyCart));

          // Hi·ªÉn th·ªã th√¥ng b√°o ƒëƒÉng xu·∫•t th√†nh c√¥ng
          this.showLogoutNotification();

          // Chuy·ªÉn h∆∞·ªõng v·ªÅ trang ch·ªß sau 1 gi√¢y
          setTimeout(() => {
            window.location.href = "../index.html";
          }, 1000);
        }

        // L∆∞u gi·ªè h√†ng c·ªßa user tr∆∞·ªõc khi ƒëƒÉng xu·∫•t
        saveUserCartBeforeLogout() {
          const userData = JSON.parse(localStorage.getItem("currentUser"));
          if (!userData || !userData.isLoggedIn) return;

          const userId = userData.phone || userData.email;
          const cartData = JSON.parse(localStorage.getItem("cartData")) || {
            items: [],
          };

          if (cartData.items.length > 0) {
            // L∆∞u gi·ªè h√†ng v·ªõi key l√† user ID
            localStorage.setItem(`cart_${userId}`, JSON.stringify(cartData));
            console.log(`üíæ ƒê√£ l∆∞u gi·ªè h√†ng cho user: ${userId}`, cartData);
          }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o ƒëƒÉng xu·∫•t th√†nh c√¥ng
        showLogoutNotification() {
          const notification = document.createElement("div");
          notification.style.cssText = `
                    position: fixed;
                    top: 120px;
                    right: 20px;
                    background: linear-gradient(135deg, #6c757d, #495057);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    animation: slideIn 0.3s ease;
                `;
          notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng! ƒêang chuy·ªÉn h∆∞·ªõng...</span>
                    </div>
                `;

          document.body.appendChild(notification);

          setTimeout(() => {
            notification.style.animation = "slideOut 0.3s ease";
            setTimeout(() => {
              if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
              }
            }, 300);
          }, 3000);
        }

        // Thi·∫øt l·∫≠p event listeners
        setupEventListeners() {
          // N√∫t ƒëƒÉng xu·∫•t
          const logoutBtn = document.getElementById("logoutBtn");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", () => {
              this.handleLogout();
            });
          }

          // Ki·ªÉm tra khi click v√†o gi·ªè h√†ng
          const cartIcon = document.getElementById("cart-icon");
          if (cartIcon) {
            cartIcon.addEventListener("click", (e) => {
              if (!this.checkLoginStatus()) {
                e.preventDefault();
                e.stopPropagation();
                this.showLoginRequiredNotification();
              }
            });
          }
        }
      }

      // Qu·∫£n l√Ω gi·ªè h√†ng, thanh to√°n v√† ƒë∆°n h√†ng v·ªõi h·ªá th·ªëng user ri√™ng bi·ªát
      class OrderManager {
        constructor() {
          this.cart = JSON.parse(localStorage.getItem("cartData"))?.items || [];
          this.orders = this.loadUserOrders();
          this.currentPage = "cart-page";
          this.init();
        }

        // L·∫•y ID c·ªßa user hi·ªán t·∫°i
        getUserId() {
          const userData = JSON.parse(localStorage.getItem("currentUser"));
          if (userData && userData.isLoggedIn) {
            return userData.phone || userData.email;
          }
          return null;
        }

        // L·∫•y th√¥ng tin user hi·ªán t·∫°i
        getUserInfo() {
          const userData = JSON.parse(localStorage.getItem("currentUser"));
          if (userData && userData.isLoggedIn) {
            return {
              userId: userData.phone || userData.email,
              fullname: userData.fullname,
              email: userData.email,
              phone: userData.phone,
            };
          }
          return null;
        }

        // T·∫£i l·ªãch s·ª≠ ƒë∆°n h√†ng c·ªßa user hi·ªán t·∫°i
        loadUserOrders() {
          const userId = this.getUserId();
          if (!userId) {
            console.log("‚ùå Kh√¥ng t√¨m th·∫•y user ID");
            return [];
          }

          const userOrdersKey = `userOrders_${userId}`;
          const orders = JSON.parse(localStorage.getItem(userOrdersKey)) || [];
          console.log(
            `üì¶ ƒê√£ t·∫£i ${orders.length} ƒë∆°n h√†ng cho user: ${userId}`
          );
          return orders;
        }

        // L∆∞u l·ªãch s·ª≠ ƒë∆°n h√†ng c·ªßa user hi·ªán t·∫°i
        saveUserOrders() {
          const userId = this.getUserId();
          if (!userId) {
            console.log("‚ùå Kh√¥ng th·ªÉ l∆∞u orders: Kh√¥ng t√¨m th·∫•y user ID");
            return;
          }

          const userOrdersKey = `userOrders_${userId}`;
          localStorage.setItem(userOrdersKey, JSON.stringify(this.orders));
          this.updateOrdersCount();
          console.log(
            `üíæ ƒê√£ l∆∞u ${this.orders.length} ƒë∆°n h√†ng cho user: ${userId}`
          );
        }

        // G·ª≠i ƒë∆°n h√†ng l√™n admin
        sendOrderToAdmin(orderData) {
          try {
            // L·∫•y danh s√°ch ƒë∆°n h√†ng t·ª´ admin ho·∫∑c t·∫°o m·ªõi
            const adminOrders =
              JSON.parse(localStorage.getItem("adminOrders")) || [];

            // T·∫°o ƒë·ªëi t∆∞·ª£ng ƒë∆°n h√†ng cho admin
            const adminOrder = {
              ...orderData,
              id: orderData.id,
              receivedAt: new Date().toISOString(),
              adminStatus: "pending",
              adminNotes: "",
              userInfo: this.getUserInfo() || {
                userId: orderData.userId,
                fullname: orderData.shippingInfo.fullname,
                phone: orderData.shippingInfo.phone,
                email: orderData.email,
              },
            };

            // Th√™m ƒë∆°n h√†ng m·ªõi v√†o danh s√°ch admin
            adminOrders.unshift(adminOrder);

            // L∆∞u l·∫°i danh s√°ch ƒë∆°n h√†ng admin
            localStorage.setItem("adminOrders", JSON.stringify(adminOrders));

            console.log("üì§ ƒê√£ g·ª≠i ƒë∆°n h√†ng l√™n admin:", adminOrder.id);
            console.log("üìã T·ªïng s·ªë ƒë∆°n h√†ng trong admin:", adminOrders.length);

            // ƒê·ªíNG B·ªò V·ªöI USER ORDERS - QUAN TR·ªåNG
            this.syncOrdersToUserOrders(adminOrder);

            return true;
          } catch (error) {
            console.error("‚ùå L·ªói khi g·ª≠i ƒë∆°n h√†ng l√™n admin:", error);
            return false;
          }
        }

        // ƒê·ªìng b·ªô ƒë∆°n h√†ng v·ªõi userOrders
        syncOrdersToUserOrders(adminOrder) {
          try {
            const userId = this.getUserId();
            if (!userId) {
              console.log("‚ùå Kh√¥ng th·ªÉ ƒë·ªìng b·ªô: Kh√¥ng t√¨m th·∫•y user ID");
              return;
            }

            const userOrdersKey = `userOrders_${userId}`;
            let userOrders =
              JSON.parse(localStorage.getItem(userOrdersKey)) || [];

            // Ki·ªÉm tra xem ƒë∆°n h√†ng ƒë√£ t·ªìn t·∫°i ch∆∞a
            const existingOrderIndex = userOrders.findIndex(
              (order) => order.id === adminOrder.id
            );

            if (existingOrderIndex === -1) {
              // Th√™m ƒë∆°n h√†ng m·ªõi v√†o user orders
              userOrders.unshift({
                id: adminOrder.id,
                userId: userId,
                orderDate: adminOrder.orderDate,
                status: "pending",
                items: adminOrder.items,
                subtotal: adminOrder.subtotal,
                discount: adminOrder.discount,
                total: adminOrder.total,
                shippingInfo: adminOrder.shippingInfo,
              });

              localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
              console.log(
                "‚úÖ ƒê√£ ƒë·ªìng b·ªô ƒë∆°n h√†ng v·ªõi user orders:",
                adminOrder.id
              );
            }
          } catch (error) {
            console.error("‚ùå L·ªói khi ƒë·ªìng b·ªô v·ªõi user orders:", error);
          }
        }

        // Kh√¥i ph·ª•c gi·ªè h√†ng c·ªßa user khi ƒëƒÉng nh·∫≠p
        restoreUserCart() {
          const userId = this.getUserId();
          if (!userId) return;

          const userCartKey = `cart_${userId}`;
          const savedCart = JSON.parse(localStorage.getItem(userCartKey));

          if (savedCart && savedCart.items && savedCart.items.length > 0) {
            this.cart = savedCart.items;
            this.saveCart();
            this.renderCart();
            this.updateCartCount();
            console.log(`üîÑ ƒê√£ kh√¥i ph·ª•c gi·ªè h√†ng cho user: ${userId}`);
          }
        }

        init() {
          if (!this.checkAuthentication()) {
            return;
          }

          // Kh√¥i ph·ª•c gi·ªè h√†ng c·ªßa user n·∫øu c√≥
          this.restoreUserCart();

          this.mergeDuplicateProducts();
          this.renderCart();
          this.renderOrders();
          this.setupEventListeners();
          this.updateCartCount();
          this.updateOrdersCount();

          // B·∫¨T ƒë·ªìng b·ªô th·ªùi gian th·ª±c
          this.setupRealTimeSync();
        }

        // Ki·ªÉm tra x√°c th·ª±c
        checkAuthentication() {
          const userData = JSON.parse(localStorage.getItem("currentUser"));
          if (!userData || !userData.isLoggedIn) {
            window.location.href = "../index.html";
            return false;
          }
          return true;
        }

        // H·ª£p nh·∫•t s·∫£n ph·∫©m tr√πng nhau
        mergeDuplicateProducts() {
          console.log(
            "üîÑ ƒêang h·ª£p nh·∫•t c√°c s·∫£n ph·∫©m tr√πng nhau trong gi·ªè h√†ng..."
          );

          const mergedItems = [];
          const productMap = new Map();

          this.cart.forEach((item) => {
            if (!item || !item.name || !item.price) return;

            const productKey = `${item.name}-${item.price}`;

            if (productMap.has(productKey)) {
              const existingItem = productMap.get(productKey);
              existingItem.quantity += item.quantity;
            } else {
              productMap.set(productKey, { ...item });
            }
          });

          this.cart = Array.from(productMap.values());
          this.saveCart();
          console.log("‚úÖ ƒê√£ h·ª£p nh·∫•t c√°c s·∫£n ph·∫©m tr√πng nhau trong gi·ªè h√†ng");
        }

        // Thi·∫øt l·∫≠p ƒë·ªìng b·ªô th·ªùi gian th·ª±c
        setupRealTimeSync() {
          // Ki·ªÉm tra c·∫≠p nh·∫≠t m·ªói 3 gi√¢y
          setInterval(() => {
            this.checkForStatusUpdates();
          }, 3000);
        }

        // Ki·ªÉm tra c·∫≠p nh·∫≠t tr·∫°ng th√°i t·ª´ admin
        checkForStatusUpdates() {
          const userId = this.getUserId();
          if (!userId) return;

          const userOrdersKey = `userOrders_${userId}`;
          let userOrders =
            JSON.parse(localStorage.getItem(userOrdersKey)) || [];
          let hasUpdates = false;

          // Ki·ªÉm tra t·ª´ng ƒë∆°n h√†ng
          userOrders.forEach((userOrder) => {
            // Ki·ªÉm tra trong adminOrders
            const adminOrders =
              JSON.parse(localStorage.getItem("adminOrders")) || [];
            const adminOrder = adminOrders.find((o) => o.id === userOrder.id);

            if (adminOrder && adminOrder.status !== userOrder.status) {
              console.log(
                `üîÑ Ph√°t hi·ªán thay ƒë·ªïi tr·∫°ng th√°i: ${userOrder.id} t·ª´ ${userOrder.status} -> ${adminOrder.status}`
              );
              userOrder.status = adminOrder.status;
              userOrder.lastUpdated = adminOrder.lastUpdated;
              hasUpdates = true;
            }

            // Ki·ªÉm tra trong userOrders to√†n c·ª•c
            const globalUserOrders =
              JSON.parse(localStorage.getItem("userOrders")) || [];
            const globalOrder = globalUserOrders.find(
              (o) => o.id === userOrder.id
            );

            if (globalOrder && globalOrder.status !== userOrder.status) {
              console.log(
                `üîÑ Ph√°t hi·ªán thay ƒë·ªïi t·ª´ global: ${userOrder.id} t·ª´ ${userOrder.status} -> ${globalOrder.status}`
              );
              userOrder.status = globalOrder.status;
              userOrder.lastUpdated = globalOrder.lastUpdated;
              hasUpdates = true;
            }
          });

          if (hasUpdates) {
            localStorage.setItem(userOrdersKey, JSON.stringify(userOrders));
            this.orders = userOrders;

            // N·∫øu ƒëang ·ªü trang l·ªãch s·ª≠ ƒë∆°n h√†ng, render l·∫°i
            if (this.currentPage === "order-history-page") {
              this.renderOrders();
              console.log("‚úÖ ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng t·ª´ server");
            }
          }
        }

        setupEventListeners() {
          // Navigation tabs
          document.querySelectorAll(".nav-tab").forEach((tab) => {
            tab.addEventListener("click", () => {
              const target = tab.dataset.target;
              this.navigateToPage(target);

              document.querySelectorAll(".nav-tab").forEach((t) => {
                t.classList.remove("active");
              });
              tab.classList.add("active");
            });
          });

          // Event delegation for cart items
          document
            .getElementById("cart-items-container")
            .addEventListener("click", (e) => {
              const target = e.target;
              const cartItem = target.closest(".cart-item");
              if (!cartItem) return;

              const id = cartItem.dataset.id;

              if (
                target.classList.contains("quantity-decrease") ||
                target.closest(".quantity-decrease")
              ) {
                this.decreaseQuantity(id);
              }
              if (
                target.classList.contains("quantity-increase") ||
                target.closest(".quantity-increase")
              ) {
                this.increaseQuantity(id);
              }
              if (
                target.classList.contains("cart-item-remove") ||
                target.closest(".cart-item-remove")
              ) {
                this.removeItem(id);
              }
            });

          // Event delegation for checkout items
          document
            .getElementById("order-items-container")
            .addEventListener("click", (e) => {
              const target = e.target;
              const orderItem = target.closest(".order-item");
              if (!orderItem) return;

              const id = orderItem.dataset.id;

              if (
                target.classList.contains("quantity-decrease") ||
                target.closest(".quantity-decrease")
              ) {
                this.decreaseQuantity(id);
              }
              if (
                target.classList.contains("quantity-increase") ||
                target.closest(".quantity-increase")
              ) {
                this.increaseQuantity(id);
              }
            });

          // Go to checkout button
          document
            .getElementById("go-to-checkout")
            .addEventListener("click", () => {
              if (this.cart.length > 0) {
                this.navigateToPage("checkout-page");

                document.querySelectorAll(".nav-tab").forEach((t) => {
                  t.classList.remove("active");
                });
                document
                  .querySelector('[data-target="checkout-page"]')
                  .classList.add("active");

                document.getElementById("breadcrumb-current").textContent =
                  "Thanh to√°n";
              } else {
                alert("Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng!");
              }
            });

          // Payment method selection
          document.querySelectorAll(".payment-method").forEach((method) => {
            method.addEventListener("click", () => {
              document.querySelectorAll(".payment-method").forEach((m) => {
                m.classList.remove("selected");
              });
              method.classList.add("selected");
            });
          });

          // City change - update districts
          const citySelect = document.getElementById("city");
          const districtSelect = document.getElementById("district");
          const districtMap = {
            hcm: [
              { value: "q1", text: "Qu·∫≠n 1" },
              { value: "q2", text: "Qu·∫≠n 2" },
              { value: "q3", text: "Qu·∫≠n 3" },
              { value: "q4", text: "Qu·∫≠n 4" },
              { value: "q5", text: "Qu·∫≠n 5" },
              { value: "q6", text: "Qu·∫≠n 6" },
              { value: "q7", text: "Qu·∫≠n 7" },
              { value: "q8", text: "Qu·∫≠n 8" },
              { value: "q9", text: "Qu·∫≠n 9" },
              { value: "q10", text: "Qu·∫≠n 10" },
              { value: "q11", text: "Qu·∫≠n 11" },
              { value: "q12", text: "Qu·∫≠n 12" },
              { value: "tb", text: "Qu·∫≠n T√¢n B√¨nh" },
              { value: "tp", text: "Qu·∫≠n T√¢n Ph√∫" },
              { value: "gb", text: "Qu·∫≠n G√≤ V·∫•p" },
              { value: "pn", text: "Qu·∫≠n Ph√∫ Nhu·∫≠n" },
              { value: "bt", text: "Qu·∫≠n B√¨nh Th·∫°nh" },
              { value: "btan", text: "Qu·∫≠n B√¨nh T√¢n" },
              { value: "thuduc", text: "Th√†nh ph·ªë Th·ªß ƒê·ª©c" },
            ],
            hn: [
              { value: "hk", text: "Qu·∫≠n Ho√†ng Ki·∫øm" },
              { value: "bd", text: "Qu·∫≠n Ba ƒê√¨nh" },
              { value: "cg", text: "Qu·∫≠n C·∫ßu Gi·∫•y" },
              { value: "th", text: "Qu·∫≠n T√¢y H·ªì" },
              { value: "dƒê", text: "Qu·∫≠n ƒê·ªëng ƒêa" },
              { value: "lb", text: "Qu·∫≠n Long Bi√™n" },
              { value: "hƒë", text: "Qu·∫≠n H√† ƒê√¥ng" },
              { value: "tx", text: "Qu·∫≠n Thanh Xu√¢n" },
              { value: "tl", text: "Qu·∫≠n T·ª´ Li√™m" },
              { value: "hbt", text: "Qu·∫≠n Hai B√† Tr∆∞ng" },
            ],
            dn: [
              { value: "hc", text: "Qu·∫≠n H·∫£i Ch√¢u" },
              { value: "tk", text: "Qu·∫≠n Thanh Kh√™" },
              { value: "stra", text: "Qu·∫≠n S∆°n Tr√†" },
              { value: "lienchieu", text: "Qu·∫≠n Li√™n Chi·ªÉu" },
              { value: "nguhanhson", text: "Qu·∫≠n Ng≈© H√†nh S∆°n" },
              { value: "camle", text: "Qu·∫≠n C·∫©m L·ªá" },
            ],
          };

          citySelect.addEventListener("change", () => {
            const city = citySelect.value;
            districtSelect.innerHTML =
              '<option value="">Ch·ªçn qu·∫≠n/huy·ªán</option>';

            if (city && districtMap[city]) {
              districtMap[city].forEach((district) => {
                const option = document.createElement("option");
                option.value = district.value;
                option.textContent = district.text;
                districtSelect.appendChild(option);
              });
            }
          });

          // Complete order button
          document
            .getElementById("complete-order")
            .addEventListener("click", () => {
              if (this.validateCheckoutForm()) {
                this.processOrder();
              }
            });

          // Form validation
          document.querySelectorAll(".form-input").forEach((input) => {
            if (input.hasAttribute("required")) {
              input.addEventListener("blur", () => {
                this.validateField(input);
              });
            }
          });

          // Phone number input restriction
          const phoneInput = document.getElementById("phone");
          phoneInput.addEventListener("input", (e) => {
            let value = e.target.value.replace(/\D/g, "");
            if (value.length > 10) {
              value = value.slice(0, 10);
            }
            e.target.value = value;
            this.validatePhoneField(phoneInput);
          });

          // Email input
          const emailInput = document.getElementById("email");
          emailInput.addEventListener("input", (e) => {
            let value = e.target.value;
            if (!value.trim()) return;

            if (value.includes("@gmail.com")) {
              value = value.replace("@gmail.com", "");
            }

            value = value.replace(/[^a-zA-Z0-9._-]/g, "");

            if (value.length > 0) {
              e.target.value = value + "@gmail.com";
              const cursorPosition = value.length;
              e.target.setSelectionRange(cursorPosition, cursorPosition);
            }
          });

          emailInput.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" || e.key === "Delete") {
              const value = e.target.value;
              if (value === "@gmail.com") {
                e.target.value = "";
              }
            }
          });

          // Name input
          document.getElementById("fullname").addEventListener("input", (e) => {
            e.target.value = e.target.value.replace(
              /[^a-zA-Z√Ä√Å√Ç√É√à√â√ä√å√ç√í√ì√î√ï√ô√ö√ù√†√°√¢√£√®√©√™√¨√≠√≤√≥√¥√µ√π√∫√ΩƒÇƒÉƒêƒëƒ®ƒ©≈®≈©∆†∆°∆Ø∆∞·∫†-·ªπ\s']/g,
              ""
            );
          });

          document.getElementById("fullname").addEventListener("blur", (e) => {
            if (e.target.value.trim()) {
              e.target.value = this.capitalizeName(e.target.value);
            }
          });

          // Order filters
          document
            .getElementById("status-filter")
            .addEventListener("change", () => {
              this.renderOrders();
            });

          document
            .getElementById("time-filter")
            .addEventListener("change", () => {
              this.renderOrders();
            });

          document
            .getElementById("refresh-orders")
            .addEventListener("click", () => {
              // Reload orders t·ª´ localStorage ƒë·ªÉ c·∫≠p nh·∫≠t t·ª´ admin
              this.orders = this.loadUserOrders();
              this.renderOrders();
              alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t l·ªãch s·ª≠ ƒë∆°n h√†ng t·ª´ m√°y ch·ªß");
            });

          // Order details toggle
          document
            .getElementById("order-list-container")
            .addEventListener("click", (e) => {
              if (
                e.target.classList.contains("btn-view-details") ||
                e.target.closest(".btn-view-details")
              ) {
                const orderCard = e.target.closest(".order-card");
                const orderId = orderCard.dataset.id;
                this.toggleOrderDetails(orderId);
              }
            });

          // X·ª≠ l√Ω n√∫t quay v·ªÅ trang ch·ªß
          document.querySelector(".btn-home").addEventListener("click", (e) => {
            e.preventDefault();
            this.resetCart();
            window.location.href = "../index.html";
          });
        }

        renderCart() {
          this.renderCartItems();
          this.renderOrderItems();
          this.renderConfirmationItems();
          this.updateTotals();
        }

        renderCartItems() {
          const container = document.getElementById("cart-items-container");

          if (this.cart.length === 0) {
            container.innerHTML = `
                      <div class="empty-state">
                          <i class="fas fa-shopping-cart"></i>
                          <p>Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng</p>
                          <button class="btn btn-continue" onclick="window.location.href='../index.html'">
                              <i class="fas fa-arrow-left"></i> Ti·∫øp t·ª•c mua h√†ng
                          </button>
                      </div>
                  `;
            return;
          }

          container.innerHTML = this.cart
            .map(
              (item) => `
                      <div class="cart-item" data-id="${item.id}">
                          <div class="cart-item-image">
                              <img src="${item.image}" alt="${
                item.name
              }" onerror="this.src='../image/placeholder.jpg'">
                          </div>
                          <div class="cart-item-info">
                              <div class="cart-item-name">${item.name}</div>
                              <div class="cart-item-sku">M√£: ${item.sku}</div>
                              <div class="cart-item-price">${this.formatPrice(
                                item.price
                              )}</div>
                          </div>
                          <div class="cart-item-quantity">
                              <button class="quantity-btn quantity-decrease" ${
                                item.quantity <= 1 ? "disabled" : ""
                              }>
                                  <i class="fas fa-minus"></i>
                              </button>
                              <input type="number" class="quantity-input" value="${
                                item.quantity
                              }" min="1" readonly>
                              <button class="quantity-btn quantity-increase">
                                  <i class="fas fa-plus"></i>
                              </button>
                          </div>
                          <div class="cart-item-total">${this.formatPrice(
                            item.price * item.quantity
                          )}</div>
                          <div class="cart-item-remove">
                              <i class="fas fa-trash"></i>
                          </div>
                      </div>
                  `
            )
            .join("");
        }

        renderOrderItems() {
          const container = document.getElementById("order-items-container");

          if (this.cart.length === 0) {
            container.innerHTML = "<p>Gi·ªè h√†ng tr·ªëng</p>";
            return;
          }

          container.innerHTML = this.cart
            .map(
              (item) => `
                      <div class="order-item" data-id="${item.id}">
                          <div class="order-item-image">
                              <img src="${item.image}" alt="${
                item.name
              }" onerror="this.src='../image/placeholder.jpg'">
                          </div>
                          <div class="order-item-info">
                              <div class="order-item-name">${item.name}</div>
                              <div class="order-item-price">${this.formatPrice(
                                item.price
                              )}</div>
                              <div class="order-item-quantity">
                                  <button class="quantity-btn quantity-decrease" ${
                                    item.quantity <= 1 ? "disabled" : ""
                                  }>
                                      <i class="fas fa-minus"></i>
                                  </button>
                                  <span>${item.quantity}</span>
                                  <button class="quantity-btn quantity-increase">
                                      <i class="fas fa-plus"></i>
                                  </button>
                              </div>
                          </div>
                      </div>
                  `
            )
            .join("");
        }

        renderConfirmationItems() {
          const container = document.getElementById("confirmation-items-body");

          if (this.cart.length === 0) {
            container.innerHTML =
              '<tr><td colspan="4">Kh√¥ng c√≥ s·∫£n ph·∫©m</td></tr>';
            return;
          }

          container.innerHTML = this.cart
            .map(
              (item) => `
                      <tr>
                          <td class="item-name">${item.name}</td>
                          <td>${item.quantity}</td>
                          <td style="text-align: right" class="item-price">${this.formatPrice(
                            item.price
                          )}</td>
                          <td style="text-align: right" class="item-price">${this.formatPrice(
                            item.price * item.quantity
                          )}</td>
                      </tr>
                  `
            )
            .join("");
        }

        renderOrders() {
          const container = document.getElementById("order-list-container");
          const statusFilter = document.getElementById("status-filter").value;
          const timeFilter = document.getElementById("time-filter").value;

          let filteredOrders = [...this.orders];

          // L·ªçc theo tr·∫°ng th√°i
          if (statusFilter !== "all") {
            filteredOrders = filteredOrders.filter(
              (order) => order.status === statusFilter
            );
          }

          // L·ªçc theo th·ªùi gian
          if (timeFilter !== "all") {
            const now = new Date();
            let cutoffDate;

            switch (timeFilter) {
              case "7days":
                cutoffDate = new Date(now.setDate(now.getDate() - 7));
                break;
              case "30days":
                cutoffDate = new Date(now.setDate(now.getDate() - 30));
                break;
              case "3months":
                cutoffDate = new Date(now.setMonth(now.getMonth() - 3));
                break;
              case "6months":
                cutoffDate = new Date(now.setMonth(now.getMonth() - 6));
                break;
            }

            filteredOrders = filteredOrders.filter((order) => {
              const orderDate = new Date(order.orderDate);
              return orderDate >= cutoffDate;
            });
          }

          // S·∫Øp x·∫øp theo th·ªùi gian (m·ªõi nh·∫•t tr∆∞·ªõc)
          filteredOrders.sort(
            (a, b) => new Date(b.orderDate) - new Date(a.orderDate)
          );

          if (filteredOrders.length === 0) {
            container.innerHTML = `
                      <div class="empty-state">
                          <i class="fas fa-box-open"></i>
                          <p>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
                          <button class="btn btn-continue" onclick="orderManager.navigateToPage('cart-page')">
                              <i class="fas fa-shopping-cart"></i> Mua s·∫Øm ngay
                          </button>
                      </div>
                  `;
            return;
          }

          container.innerHTML = filteredOrders
            .map((order) => this.createOrderCard(order))
            .join("");
        }

        createOrderCard(order) {
          const itemsCount = order.items.reduce(
            (sum, item) => sum + item.quantity,
            0
          );
          const statusClass = `status-${order.status}`;
          const statusText = this.getStatusText(order.status);

          // Th√™m th·ªùi gian c·∫≠p nh·∫≠t n·∫øu c√≥
          const lastUpdated = order.lastUpdated
            ? ` (C·∫≠p nh·∫≠t: ${new Date(order.lastUpdated).toLocaleTimeString(
                "vi-VN"
              )})`
            : "";

          const itemsList = order.items
            .map(
              (item) => `
                      <div class="order-item-history">
                          <div class="order-item-image-history">
                              <img src="${item.image}" alt="${
                item.name
              }" onerror="this.src='../image/placeholder.jpg'">
                          </div>
                          <div class="order-item-info-history">
                              <div class="order-item-name-history">${
                                item.name
                              }</div>
                              <div class="order-item-price-history">${this.formatPrice(
                                item.price
                              )}</div>
                              <div class="order-item-quantity-history">S·ªë l∆∞·ª£ng: ${
                                item.quantity
                              }</div>
                          </div>
                      </div>
                  `
            )
            .join("");

          return `
                      <div class="order-card" data-id="${order.id}">
                          <div class="order-header">
                              <div class="order-info">
                                  <div class="order-id">${order.id}</div>
                                  <div class="order-date">
                                      ${new Date(
                                        order.orderDate
                                      ).toLocaleDateString("vi-VN")}
                                      ${lastUpdated}
                                  </div>
                              </div>
                              <div class="order-status ${statusClass}">${statusText}</div>
                          </div>
                          <div class="order-summary-short">
                              <div class="order-items-count">${itemsCount} s·∫£n ph·∫©m</div>
                              <div class="order-total">${this.formatPrice(
                                order.total
                              )}</div>
                          </div>
                          <div class="order-details">
                              <div class="order-items-list">
                                  ${itemsList}
                              </div>
                              <div class="order-shipping-info">
                                  <div class="shipping-title">Th√¥ng tin giao h√†ng</div>
                                  <div class="shipping-address">
                                      <strong>${
                                        order.shippingInfo.fullname
                                      }</strong><br>
                                      ${order.shippingInfo.phone}<br>
                                      ${order.shippingInfo.address}, ${
            order.shippingInfo.district
          }, ${order.shippingInfo.city}
                                  </div>
                              </div>
                          </div>
                          <button class="btn-view-details" style="margin-top: 15px;">
                              <i class="fas fa-chevron-down"></i> Xem chi ti·∫øt
                          </button>
                      </div>
                  `;
        }

        toggleOrderDetails(orderId) {
          const orderCard = document.querySelector(
            `.order-card[data-id="${orderId}"]`
          );
          const details = orderCard.querySelector(".order-details");
          const button = orderCard.querySelector(".btn-view-details");

          if (details.classList.contains("active")) {
            details.classList.remove("active");
            button.innerHTML =
              '<i class="fas fa-chevron-down"></i> Xem chi ti·∫øt';
          } else {
            details.classList.add("active");
            button.innerHTML = '<i class="fas fa-chevron-up"></i> Thu g·ªçn';
          }
        }

        getStatusText(status) {
          const statusMap = {
            pending: "Ch·ªù x√°c nh·∫≠n",
            confirmed: "ƒê√£ x√°c nh·∫≠n",
            shipping: "ƒêang giao h√†ng",
            completed: "ƒê√£ ho√†n th√†nh",
            cancelled: "ƒê√£ h·ªßy",
          };
          return statusMap[status] || status;
        }

        updateTotals() {
          const subtotal = this.cart.reduce(
            (sum, item) => sum + item.price * item.quantity,
            0
          );
          const discount = subtotal * 0.2;
          const total = subtotal - discount;

          document.getElementById("subtotal").textContent =
            this.formatPrice(subtotal);
          document.getElementById(
            "discount"
          ).textContent = `-${this.formatPrice(discount)}`;
          document.getElementById("total").textContent =
            this.formatPrice(total);

          document.getElementById("checkout-subtotal").textContent =
            this.formatPrice(subtotal);
          document.getElementById(
            "checkout-discount"
          ).textContent = `-${this.formatPrice(discount)}`;
          document.getElementById("checkout-total").textContent =
            this.formatPrice(total);

          document.getElementById("confirmation-subtotal").textContent =
            this.formatPrice(subtotal);
          document.getElementById(
            "confirmation-discount"
          ).textContent = `-${this.formatPrice(discount)}`;
          document.getElementById("confirmation-total").textContent =
            this.formatPrice(total);
        }

        updateCartCount() {
          const totalItems = this.cart.reduce(
            (sum, item) => sum + item.quantity,
            0
          );
          document.getElementById("cart-count").textContent = totalItems;
          document.getElementById("cart-tab-count").textContent = totalItems;
        }

        updateOrdersCount() {
          document.getElementById("orders-tab-count").textContent =
            this.orders.length;
        }

        increaseQuantity(id) {
          const item = this.cart.find((item) => item.id === id);
          if (item) {
            // ‚úÖ KI·ªÇM TRA STOCK T·ª™ LOCALSTORAGE-INVENTORY
            const inventory =
              JSON.parse(localStorage.getItem("inventory")) || [];
            // T√¨m s·∫£n ph·∫©m trong inventory b·∫±ng t√™n ho·∫∑c sku
            const productInventory = inventory.find(
              (i) =>
                i.productId === item.id ||
                i.sku === item.sku ||
                i.name === item.name
            );
            const stock = productInventory ? productInventory.stock : null;

            // N·∫øu stock = 0 ho·∫∑c quantity s·∫Øp v∆∞·ª£t qu√° stock
            if (stock !== null && item.quantity >= stock) {
              alert("‚ùå S·ªë l∆∞·ª£ng s·∫£n ph·∫©m kh√¥ng ƒë·ªß");
              return; // D·ª´ng vi·ªác tƒÉng quantity
            }

            item.quantity++;
            this.saveCart();
            this.renderCart();
            this.updateCartCount();
          }
        }

        decreaseQuantity(id) {
          const item = this.cart.find((item) => item.id === id);
          if (item && item.quantity > 1) {
            item.quantity--;
            this.saveCart();
            this.renderCart();
            this.updateCartCount();
          }
        }

        removeItem(id) {
          const itemElement = document.querySelector(
            `.cart-item[data-id="${id}"]`
          );
          if (itemElement) {
            itemElement.classList.add("removing");
            setTimeout(() => {
              this.cart = this.cart.filter((item) => item.id !== id);
              this.saveCart();
              this.renderCart();
              this.updateCartCount();
            }, 300);
          }
        }

        saveCart() {
          const cartData = {
            items: this.cart,
            subtotal: this.cart.reduce(
              (sum, item) => sum + item.price * item.quantity,
              0
            ),
            discount:
              this.cart.reduce(
                (sum, item) => sum + item.price * item.quantity,
                0
              ) * 0.2,
            total:
              this.cart.reduce(
                (sum, item) => sum + item.price * item.quantity,
                0
              ) * 0.8,
            lastUpdated: new Date().toISOString(),
          };
          localStorage.setItem("cartData", JSON.stringify(cartData));
        }

        navigateToPage(pageId) {
          document.querySelectorAll(".page-section").forEach((page) => {
            page.classList.remove("active");
          });
          document.getElementById(pageId).classList.add("active");
          this.currentPage = pageId;

          const breadcrumbCurrent =
            document.getElementById("breadcrumb-current");
          if (pageId === "cart-page") {
            breadcrumbCurrent.textContent = "Gi·ªè h√†ng";
          } else if (pageId === "checkout-page") {
            breadcrumbCurrent.textContent = "Thanh to√°n";
          } else if (pageId === "confirmation-page") {
            breadcrumbCurrent.textContent = "X√°c nh·∫≠n ƒë∆°n h√†ng";
          } else if (pageId === "order-history-page") {
            breadcrumbCurrent.textContent = "L·ªãch s·ª≠ ƒë∆°n h√†ng";
          }
        }

        validateField(field) {
          const errorElement = document.getElementById(`${field.id}-error`);
          if (field.hasAttribute("required") && !field.value.trim()) {
            field.classList.add("error");
            errorElement.style.display = "block";
            return false;
          } else {
            field.classList.remove("error");
            errorElement.style.display = "none";
            return true;
          }
        }

        validatePhoneField(field) {
          const errorElement = document.getElementById("phone-error");
          const value = field.value.trim();
          const phoneRegex = /^(0)\d{9}$/;

          if (!value) {
            field.classList.add("error");
            errorElement.textContent = "Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i";
            errorElement.style.display = "block";
            return false;
          } else if (!phoneRegex.test(value)) {
            field.classList.add("error");
            errorElement.textContent =
              "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p d·∫°ng 0xxxxxxxxx";
            errorElement.style.display = "block";
            return false;
          } else {
            field.classList.remove("error");
            errorElement.style.display = "none";
            return true;
          }
        }

        capitalizeName(name) {
          return name
            .toLowerCase()
            .split(" ")
            .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
            .join(" ")
            .trim();
        }

        validateCheckoutForm() {
          const requiredFields = [
            "fullname",
            "phone",
            "address",
            "city",
            "district",
          ];
          let isValid = true;

          requiredFields.forEach((fieldId) => {
            const field = document.getElementById(fieldId);
            if (fieldId === "phone") {
              if (!this.validatePhoneField(field)) {
                isValid = false;
              }
            } else {
              if (!this.validateField(field)) {
                isValid = false;
              }
            }
          });

          return isValid;
        }

        processOrder() {
          const userId = this.getUserId();
          if (!userId) {
            alert("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë·∫∑t h√†ng!");
            return;
          }

          if (!this.validateCheckoutForm()) {
            return;
          }

          const now = new Date();
          const orderData = {
            fullname: document.getElementById("fullname").value,
            phone: document.getElementById("phone").value,
            email: document.getElementById("email").value,
            address: document.getElementById("address").value,
            city: document.getElementById("city").options[
              document.getElementById("city").selectedIndex
            ].text,
            district:
              document.getElementById("district").options[
                document.getElementById("district").selectedIndex
              ].text,
            note: document.getElementById("note").value,
            paymentMethod: document.querySelector(".payment-method.selected")
              .dataset.method,
            orderDateISO: now.toISOString(),
            orderDateDisplay: now.toLocaleDateString("vi-VN"),
            orderId: "#WS" + Math.floor(100000 + Math.random() * 900000),
          };

          // Update confirmation page
          document.getElementById("order-id").textContent = orderData.orderId;
          document.getElementById("order-date").textContent =
            orderData.orderDateDisplay;
          document.getElementById("payment-method").textContent =
            this.getPaymentMethodName(orderData.paymentMethod);
          document.getElementById("customer-name").textContent =
            orderData.fullname;
          document.getElementById("customer-phone").textContent =
            orderData.phone;
          document.getElementById("customer-email").textContent =
            orderData.email || "Kh√¥ng c√≥";
          document.getElementById(
            "customer-address"
          ).textContent = `${orderData.address}, ${orderData.district}, ${orderData.city}`;

          if (orderData.note) {
            document.getElementById("note-text").textContent = orderData.note;
          } else {
            document.getElementById("customer-note").style.display = "none";
          }

          // T·∫°o ƒë∆°n h√†ng m·ªõi cho l·ªãch s·ª≠ - TH√äM userId
          const newOrder = {
            id: orderData.orderId,
            userId: userId,
            orderDate: orderData.orderDateISO,
            status: "pending",
            items: [...this.cart],
            subtotal: this.calculateSubtotal(),
            discount: this.calculateDiscount(),
            total: this.calculateTotal(),
            shippingInfo: {
              fullname: orderData.fullname,
              phone: orderData.phone,
              address: orderData.address,
              district: orderData.district,
              city: orderData.city,
            },
          };

          // Th√™m v√†o danh s√°ch ƒë∆°n h√†ng c·ªßa user
          this.orders.unshift(newOrder);
          this.saveUserOrders();

          // QUAN TR·ªåNG: G·ª≠i ƒë∆°n h√†ng l√™n admin
          const sentToAdmin = this.sendOrderToAdmin(newOrder);

          if (sentToAdmin) {
            console.log("‚úÖ ƒê∆°n h√†ng ƒë√£ ƒë∆∞·ª£c g·ª≠i l√™n admin th√†nh c√¥ng");

            // C·∫¨P NH·∫¨T QUAN TR·ªåNG: ƒê·ªìng b·ªô v·ªõi userOrders chung
            this.updateGlobalUserOrders(newOrder);
          } else {
            console.error("‚ùå L·ªói khi g·ª≠i ƒë∆°n h√†ng l√™n admin");
          }

          // L∆∞u th√¥ng tin ƒë∆°n h√†ng ƒë·ªÉ hi·ªÉn th·ªã tr√™n trang ch·ªß
          this.saveOrderData({ ...orderData });

          // Reset gi·ªè h√†ng v·ªÅ 0 ngay sau khi ƒë·∫∑t h√†ng th√†nh c√¥ng
          this.resetCartImmediately();

          this.navigateToPage("confirmation-page");

          // Update active tab
          document.querySelectorAll(".nav-tab").forEach((t) => {
            t.classList.remove("active");
          });
          document
            .querySelector('[data-target="confirmation-page"]')
            .classList.add("active");
        }

        // C√°c ph∆∞∆°ng th·ª©c t√≠nh to√°n
        calculateSubtotal() {
          return this.cart.reduce(
            (sum, item) => sum + item.price * item.quantity,
            0
          );
        }

        calculateDiscount() {
          return this.calculateSubtotal() * 0.2;
        }

        calculateTotal() {
          return this.calculateSubtotal() - this.calculateDiscount();
        }

        // C·∫≠p nh·∫≠t userOrders to√†n c·ª•c
        updateGlobalUserOrders(order) {
          try {
            let globalUserOrders =
              JSON.parse(localStorage.getItem("userOrders")) || [];

            // Ki·ªÉm tra xem ƒë∆°n h√†ng ƒë√£ t·ªìn t·∫°i ch∆∞a
            const existingOrderIndex = globalUserOrders.findIndex(
              (o) => o.id === order.id
            );

            if (existingOrderIndex === -1) {
              globalUserOrders.unshift(order);
              localStorage.setItem(
                "userOrders",
                JSON.stringify(globalUserOrders)
              );
              console.log("‚úÖ ƒê√£ c·∫≠p nh·∫≠t userOrders to√†n c·ª•c:", order.id);
            }
          } catch (error) {
            console.error("‚ùå L·ªói khi c·∫≠p nh·∫≠t userOrders to√†n c·ª•c:", error);
          }
        }

        // Reset gi·ªè h√†ng ngay l·∫≠p t·ª©c
        resetCartImmediately() {
          const emptyCartData = {
            items: [],
            subtotal: 0,
            discount: 0,
            total: 0,
            lastUpdated: new Date().toISOString(),
          };

          localStorage.setItem("cartData", JSON.stringify(emptyCartData));
          this.cart = [];
          this.updateCartCount();
          console.log("üîÑ ƒê√£ reset gi·ªè h√†ng v·ªÅ 0 sau khi ƒë·∫∑t h√†ng th√†nh c√¥ng");
        }

        // Reset gi·ªè h√†ng (s·∫Ω ƒë∆∞·ª£c g·ªçi khi quay v·ªÅ trang ch·ªß)
        resetCart() {
          const emptyCartData = {
            items: [],
            subtotal: 0,
            discount: 0,
            total: 0,
            lastUpdated: new Date().toISOString(),
          };

          localStorage.setItem("cartData", JSON.stringify(emptyCartData));
          this.cart = [];
          this.renderCart();
          this.updateCartCount();
          console.log("‚úÖ ƒê√£ reset gi·ªè h√†ng sau khi xem x√°c nh·∫≠n ƒë∆°n h√†ng");
        }

        // L∆∞u th√¥ng tin ƒë∆°n h√†ng t·∫°m th·ªùi
        saveOrderData(orderData) {
          const orderInfo = {
            ...orderData,
            cartItems: [...this.cart],
            orderCompleted: true,
            completedAt: new Date().toISOString(),
          };
          localStorage.setItem("lastOrder", JSON.stringify(orderInfo));
          console.log("üíæ ƒê√£ l∆∞u th√¥ng tin ƒë∆°n h√†ng:", orderInfo);
        }

        getPaymentMethodName(method) {
          const methods = {
            cod: "COD (Thanh to√°n khi nh·∫≠n h√†ng)",
            banking: "Chuy·ªÉn kho·∫£n ng√¢n h√†ng",
            momo: "V√≠ MoMo",
          };
          return methods[method] || method;
        }

        formatPrice(price) {
          return new Intl.NumberFormat("vi-VN", {
            style: "currency",
            currency: "VND",
          }).format(price);
        }
      }

      // Kh·ªüi t·∫°o khi trang t·∫£i xong
      let orderManager;
      document.addEventListener("DOMContentLoaded", () => {
        const loginManager = new LoginManager();
        orderManager = new OrderManager();

        // Ki·ªÉm tra n·∫øu ch∆∞a ƒëƒÉng nh·∫≠p th√¨ hi·ªÉn th·ªã th√¥ng b√°o
        if (!loginManager.checkLoginStatus()) {
          setTimeout(() => {
            window.location.href = "../index.html";
          }, 3000);
        }

        // ‚úÖ TH√äM: H√†m ki·ªÉm tra ƒë·ªãnh k·ª≥ xem t√†i kho·∫£n c√≥ b·ªã x√≥a/kh√≥a
        function checkAccountStatus() {
          const currentUser = JSON.parse(localStorage.getItem("currentUser"));
          if (!currentUser || !currentUser.isLoggedIn) return;

          const allUsers = JSON.parse(localStorage.getItem("users")) || [];
          const userExists = allUsers.some(
            (u) => u.phone === currentUser.phone && !u.locked
          );

          if (!userExists) {
            // T√†i kho·∫£n b·ªã x√≥a ho·∫∑c kh√≥a
            const isLocked = allUsers.some(
              (u) => u.phone === currentUser.phone && u.locked
            );
            if (isLocked) {
              alert("‚ùå T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ b·ªã kh√≥a!");
            } else {
              alert("‚ùå T√†i kho·∫£n c·ªßa b·∫°n kh√¥ng t·ªìn t·∫°i!");
            }
            localStorage.removeItem("currentUser");
            localStorage.removeItem("cartData");
            setTimeout(() => {
              window.location.href = "../index.html";
            }, 500);
          }
        }

        // Ki·ªÉm tra m·ªói 2 gi√¢y
        setInterval(checkAccountStatus, 2000);

        // ‚úÖ TH√äM: Listener cho s·ª± ki·ªán t√†i kho·∫£n b·ªã kh√≥a
        window.addEventListener("userAccountLocked", function () {
          const currentUser = JSON.parse(localStorage.getItem("currentUser"));
          if (currentUser && currentUser.isLoggedIn) {
            alert("‚ùå T√†i kho·∫£n c·ªßa b·∫°n ƒë√£ b·ªã kh√≥a!");
            // Kh√¥ng x√≥a to√†n b·ªô data ‚Äî ch·ªâ logout v√† ƒë√°nh d·∫•u locked
            currentUser.isLoggedIn = false;
            currentUser.locked = true;
            localStorage.setItem("currentUser", JSON.stringify(currentUser));
            setTimeout(() => {
              window.location.href = "../index.html";
            }, 500);
          }
        });

        // ‚úÖ TH√äM: Listener cho s·ª± ki·ªán t√†i kho·∫£n b·ªã x√≥a
        window.addEventListener("userAccountDeleted", function () {
          const currentUser = JSON.parse(localStorage.getItem("currentUser"));
          if (currentUser && currentUser.isLoggedIn) {
            alert("‚ùå T√†i kho·∫£n c·ªßa b·∫°n kh√¥ng t·ªìn t·∫°i!");
            // X√≥a ho√†n to√†n khi t√†i kho·∫£n b·ªã x√≥a
            localStorage.removeItem("currentUser");
            localStorage.removeItem("cartData");
            setTimeout(() => {
              window.location.href = "../index.html";
            }, 500);
          }
        });
      });
    </script>
  </body>
</html>
